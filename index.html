<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marleen Molenaar Collection ‚Äî Wholesale Catalogue</title>
<meta name="description" content="Premium children's & ladies' sleepwear wholesale catalogue ‚Äî Marleen Molenaar. All items new with tags.">
<style>
  :root{ --purple1:#667eea; --purple2:#764ba2; --bg:#f5f5fb; --card:#fff; --ink:#1d1b2e; --muted:#6d5e85; --border:#e8e6f3; --chip:#efe9ff; --tint:#f6f1ff; --link:#1a5cff; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .hero{background:linear-gradient(135deg,var(--purple1),var(--purple2));color:#fff;text-align:center;padding:42px 16px 36px;box-shadow:inset 0 -1px 0 rgba(255,255,255,.25)}
  .hero h1{font-size:44px;line-height:1.1;margin:0 0 8px;font-weight:800}
  .hero p{margin:0 0 16px;opacity:.95;font-size:18px}
  .pill{display:inline-block;padding:10px 18px;border-radius:999px;background:rgba(255,255,255,.22);border:1px solid rgba(255,255,255,.35);backdrop-filter:blur(8px);font-weight:700}
  .wrap{max-width:1200px;margin:0 auto;padding:0 16px}

  .panel{background:var(--card);border:1px solid var(--border);border-radius:14px;margin:18px auto;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .panel h3{margin:0 0 10px;font-size:18px;color:#2a1a47;display:flex;align-items:center;gap:8px}

  .size-tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px}
  .size-tile{background:var(--tint);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;box-shadow:inset 0 -1px 0 #efeaff}
  .size-tile b{display:block;font-size:22px;color:#2a1a47}
  .size-tile span{display:block;font-size:13px;color:var(--muted);margin-top:4px}

  .proof{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .proof-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:inset 0 -1px 0 #efeaff}
  .proof-card h4{margin:0 0 6px;color:#2a1a47}
  .proof-card a{color:var(--link);text-decoration:none;font-weight:600}
  .proof-card p{margin:6px 0 0;color:#6d5e85;font-size:14px}

  .filters{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin:18px 0;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .filters label{display:block;font-size:13px;color:#4b4267;margin-bottom:4px}
  .filters input,.filters select{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;min-width:200px}
  .filters .meta{margin-top:10px;color:var(--muted);font-size:14px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
  #totals-note,#diag{display:none}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-bottom:28px}
  .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .imgbox{height:180px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .imgbox img{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;background:#fff}
  .placeholder{font-size:14px;color:#999;text-align:center}

  .body{padding:12px}
  .title{font-weight:800;color:#2a1a47;margin:0 0 6px}
  .muted{color:#6d5e85;font-size:13px}
  .sizes{margin-top:4px}
  .sizes span{background:#f4f0ff;border:1px solid #dccfff;border-radius:6px;padding:2px 6px;margin:2px;display:inline-block;font-size:12px}
  .price-line{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
  .price-line .tag{background:#f4f0ff;border:1px solid #dccfff;border-radius:6px;padding:2px 8px;font-size:12px}

  .footer{background:#1f1640;color:#fff;margin-top:10px}
  .footer-inner{max-width:1200px;margin:0 auto;padding:22px 16px;display:flex;flex-wrap:wrap;gap:22px;justify-content:space-between}
  .footer h4{margin:0 0 8px}
  .footer a{color:#fff;text-decoration:none}
  .fine{color:#c9c4e6;font-size:13px}
</style>
</head>
<body>
  <!-- HERO -->
  <section class="hero">
    <div class="wrap">
      <h1>Marleen Molenaar Collection</h1>
      <p>Premium Children‚Äôs & Ladies‚Äô Sleepwear ‚Äî Wholesale Catalogue</p>
      <div class="pill" id="hero-pill">Loading totals‚Ä¶</div>
    </div>
  </section>

  <div class="wrap">
    <!-- SIZE BREAKDOWN -->
    <div class="panel">
      <h3>üßµ Size Breakdown ‚Äî Pieces Available</h3>
      <div class="size-tiles" id="size-tiles"></div>
    </div>

    <!-- VERIFIED CREDENTIALS & PROOF LINKS -->
    <div class="panel">
      <h3>üèÜ Verified Luxury Credentials & Proof Links</h3>
      <div class="proof">
        <div class="proof-card">
          <h4>Lane Crawford Luxury Retailer</h4>
          <a href="https://www.lanecrawford.com/brand/700351/marleen-molenaar-sleepwear/women" target="_blank" rel="noopener">View Brand Page</a>
          <p>Hong Kong‚Äôs premier luxury department store ‚Äî equivalent to Harrods. Establishes brand positioning.</p>
        </div>
        <div class="proof-card">
          <h4>Retail Pricing Evidence</h4>
          <a href="https://retykle.com/products/marleen-molenaar-pyjama-set-2-8y" target="_blank" rel="noopener">Retykle Pricing Proof</a>
          <p>Shows premium retail/resale pricing for individual pieces.</p>
        </div>
        <div class="proof-card">
          <h4>Media Coverage</h4>
          <a href="https://www.scmp.com/article/533820/eastern-premise" target="_blank" rel="noopener">South China Morning Post</a>
          <p>2006 profile: ‚Äúrunning a children‚Äôs clothing design company under her own name.‚Äù</p>
        </div>
      </div>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <div class="row">
        <div>
          <label for="size">Size</label>
          <select id="size"><option value="">All Sizes</option></select>
        </div>
        <div>
          <label for="category">Category</label>
          <select id="category"><option value="">All Categories</option></select>
        </div>
        <div style="flex:1 1 280px">
          <label for="q">Search</label>
          <input id="q" placeholder="Search name, colour, description‚Ä¶">
        </div>
      </div>
      <div class="meta">
        <div>Showing <b id="visible-count">0</b> items</div>
        <div id="totals-note"></div>
        <div id="diag"></div>
      </div>
    </div>

    <!-- PRODUCT GRID -->
    <div class="grid" id="grid"></div>
  </div>

  <!-- FOOTER / OWNER + SUMMARY -->
  <footer class="footer">
    <div class="footer-inner">
      <div>
        <h4>Contact</h4>
        <p><strong>Gary Flax:</strong> <a href="tel:+61414242142">+61 414 242 142</a></p>
        <p><strong>Location:</strong> Vaucluse, Sydney NSW</p>
        <p><strong>Viewing:</strong> Weekdays 5pm+, Weekends anytime</p>
        <p><strong>Brand:</strong> Marleen Molenaar</p>
        <p class="fine">All items new with original manufacturer tags.</p>
      </div>
      <div>
        <h4>Collection Summary</h4>
        <p id="sum-pieces">‚Äî pieces</p>
        <p id="sum-skus">‚Äî SKUs</p>
        <p id="sum-rrp">Total RRP: ‚Äî AUD</p>
        <p><strong id="sum-wholesale">Wholesale (target): ‚Äî AUD</strong></p>
        <p><strong id="sum-quick">Quick Sale (target): ‚Äî AUD</strong></p>
      </div>
    </div>
  </footer>

<script>
/* ================= CONFIG ================= */
const WHOLESALE_TOTAL_TARGET_AUD = 20000;   // tune as needed
const QUICKSALE_TOTAL_TARGET_AUD  = 12000;
const CSV_CANDIDATES = ['detailed_inventory.csv','Detailed_Inventory.csv','inventory.csv'];

/* ================= Helpers ================= */
const norm = s => (s||'').toString().trim();
const lc = s => norm(s).toLowerCase();
const toNum = x => { if(x==null) return 0; const s=String(x).replace(/[^\d.,-]/g,'').replace(/,/g,''); return parseFloat(s)||0; };
const aud = v => isFinite(v) ? `\$${v.toFixed(2)} AUD` : '‚Äî';

/* CSV parse with delimiter auto-detect */
function detectDelimiter(text){
  const first = text.split(/\r?\n/).find(l=>/[;, \t]/.test(l)) || '';
  const counts = { ',':(first.match(/,/g)||[]).length, ';':(first.match(/;/g)||[]).length, '\t':(first.match(/\t/g)||[]).length };
  return Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0] || ',';
}
function splitRow(line, delim){
  const re = new RegExp(`("([^"]|"")*"|[^${delim}]+)`, 'g');
  return (line.match(re)||[]).map(s=>s.replace(/^"|"$/g,'').replace(/""/g,'"').trim());
}
function parseCSVAuto(text){
  const delim = detectDelimiter(text);
  const lines = text.replace(/\r/g,'').split('\n').filter(l=>l.trim());
  const header = splitRow(lines.shift(), delim);
  const colsLC = header.map(h=>h.toLowerCase());
  const idx = name => colsLC.indexOf(name);

  // detect wide size columns (numeric headings like 2,4,6,8,10,12,14)
  const sizeCols = [];
  header.forEach((h,i)=>{
    const t = h.toString().trim();
    if(/^\d+$/.test(t)) sizeCols.push({label:t, i});
  });

  const map = {
    sku: idx('sku'),
    brand: idx('brand'),
    item: idx('item_name'),
    desc: idx('description'),
    category: idx('category'),
    subcat: idx('subcategory'),
    size: idx('size'),
    colour: idx('colour')!==-1?idx('colour'):idx('color'),
    gender: idx('gender'),
    condition: idx('condition'),
    qty: idx('qty'),
    rrp: (idx('rrp')!==-1 ? idx('rrp') : idx('anchor_price')),
    discounted: idx('discounted_price'),
    channel: idx('channel')
  };

  const rows = lines.map(line=>{
    const cells = splitRow(line, delim);
    const get = i => (i>=0 ? (cells[i]||'') : '');

    // build per-row sizes object from wide size columns if present
    const sizes = {};
    if(sizeCols.length){
      for(const {label,i} of sizeCols){
        const q = toNum(get(i));
        if(q>0) sizes[label] = (sizes[label]||0) + q;
      }
    }else{
      // fallback to a single "Size" + "Qty"
      const s = norm(get(map.size));
      const q = toNum(get(map.qty));
      if(s) sizes[s] = (sizes[s]||0) + q;
    }

    // quantity = sum of size quantities if we have them; else use Qty
    const qtyFromSizes = Object.values(sizes).reduce((a,b)=>a+toNum(b),0);
    const qty = qtyFromSizes>0 ? qtyFromSizes : toNum(get(map.qty));

    return {
      SKU: get(map.sku),
      Brand: get(map.brand),
      Item_Name: get(map.item),
      Description: get(map.desc),
      Category: get(map.category),
      Subcategory: get(map.subcat),
      Colour: get(map.colour),
      Gender: get(map.gender),
      Condition: get(map.condition),
      Qty: qty,
      SizesObj: sizes,
      RRP_Unit: toNum(get(map.rrp)),
      Discounted_Price: get(map.discounted),
      Channel: get(map.channel)
    };
  });

  return { rows, header, sizeCols, delim };
}

/* Image rules (from your mapping) */
const IMAGE_RULES = [
  { image:"images/image1_small.jpg",  keywords:["ella","princess","gown","pink"] },
  { image:"images/image2_small.jpg",  keywords:["cora","sleeveless","short","flower","blue"] },
  { image:"images/image2_small.jpg",  keywords:["cora","sleeveless","short","flower","light","blue"] },
  { image:"images/image3_small.jpg",  keywords:["cora","sleeveless","short","flower","pink"] },
  { image:"images/image4_small.jpg",  keywords:["ava","singlet","top","pants","green","yellow"] },
  { image:"images/image5_small.jpg",  keywords:["harper","shorts","vest","lemon"] },
  { image:"images/image5_small.jpg",  keywords:["harper","shorts","vest","green"] },
  { image:"images/image6_small.jpg",  keywords:["ruby","pyjama","boob","tube","short","pink"] },
  { image:"images/image7_small.jpg",  keywords:["ella","semi","pajama","pink"] },
  { image:"images/image8_small.jpg",  keywords:["grace","nightie","bow","off-white","organic"] },
  { image:"images/image9_small.jpg",  keywords:["isabella","nightdress","check","blue"] },
  { image:"images/image9_small.jpg",  keywords:["isabella","nightdress","check","pink"] },
  { image:"images/image10_small.jpg", keywords:["mia","shirt","long","sleeve","blue"] },
  { image:"images/image10_small.jpg", keywords:["mia","shirt","lilac"] },
  { image:"images/image11_small.jpg", keywords:["ella","suzy","90","pink"] },
  { image:"images/image12_small.jpg", keywords:["suzy","90","pink"] },
  { image:"images/image13_small.jpg", keywords:["suzy","90","pink"] },
  { image:"images/image14_small.jpg", keywords:["charlotte","suzy","90","blue"] },
  { image:"images/image15_small.jpg", keywords:["eliana","suzy","90","sleeveless","lemon","flower"] },
  { image:"images/image16_small.jpg", keywords:["cora","suzy","90","night","sleeveless","flower","blue"] },
  { image:"images/image17_small.jpg", keywords:["jack","boy","paj","blue","brown"] },
  { image:"images/image18_small.jpg", keywords:["oliver","gary","long","paj","black","check"] },
  { image:"images/image19_small.jpg", keywords:["thomas","boy","paj","short"] },
  { image:"images/image19_small.jpg", keywords:["noah","shorty"] },
  { image:"images/image20_small.jpg", keywords:["maisie","baby","top","pants","pink"] },
  { image:"images/image21_small.jpg", keywords:["olivia","girls","long","paj"] },
  { image:"images/image22_small.jpg", keywords:["aria","ladies","long","paj"] },
  { image:"images/image23_small.jpg", keywords:["layla","ladies","short","paj","sleeveless"] },
  { image:"images/image24_small.jpg", keywords:["layla","short","nightie","yellow"] },
  { image:"images/image25_small.jpg", keywords:["sophia","shirt"] },
  { image:"images/image26_small.jpg", keywords:["summer","dressing","gown"] },
  { image:"images/image27_small.jpg", keywords:["maya","gown","leopard"] },
  { image:"images/image28_small.jpg", keywords:["josh","gown","check"] },
  { image:"images/image29_small.jpg", keywords:["jack","gown","brown"] },
  { image:"images/image30_small.jpg", keywords:["fireman","raincoat","yellow","no","hat"] },
  { image:"images/image31_small.jpg", keywords:["candy","raincoat","hat","pink"] },
  { image:"images/image32_small.jpg", keywords:["candy","raincoat","pink","no","hat"] },
  { image:"images/image33_small.jpg", keywords:["fireman","raincoat","yellow","hat"] }
];
function resolveImage(name, desc, colour){
  const t = [lc(name), lc(desc), lc(colour)].join(' ');
  for(const r of IMAGE_RULES){
    if((r.keywords||[]).every(k => t.includes(k))) return r.image;
  }
  return 'images/placeholder.webp';
}

/* Aggregation per card: Item + Colour + Subcategory */
function keyOf(r){ return [r.Item_Name, r.Colour, r.Subcategory].map(v=>lc(v||'')).join(' ‚Ä¢ '); }

function aggregateItems(rows){
  const groups = new Map();
  for(const r of rows){
    const name = norm(r.Item_Name); if(!name) continue;
    const key = keyOf(r);
    if(!groups.has(key)){
      groups.set(key,{
        name: name,
        colour: norm(r.Colour),
        subcat: norm(r.Subcategory),
        desc: norm(r.Description),
        category: norm(r.Category),
        sizes:{},
        qty:0,
        rrps:[],
      });
    }
    const g = groups.get(key);
    // merge sizes
    for(const [s,q] of Object.entries(r.SizesObj||{})){
      if(toNum(q)>0) g.sizes[s] = (g.sizes[s]||0) + toNum(q);
    }
    g.qty += toNum(r.Qty);
    if(toNum(r.RRP_Unit)>0) g.rrps.push(toNum(r.RRP_Unit));
  }
  // finalize: unit RRP = mode (most frequent) else average
  const out=[];
  for(const g of groups.values()){
    let unit=g.rrps[0]||0, best=0;
    const count={};
    for(const v of g.rrps){ count[v]=(count[v]||0)+1; if(count[v]>best){best=count[v]; unit=v;} }
    if(!unit && g.rrps.length){ unit=g.rrps.reduce((a,b)=>a+b,0)/g.rrps.length; }
    out.push({...g, rrpUnit: unit});
  }
  return out;
}

function sizesToChips(sizes){
  const entries = Object.entries(sizes).filter(([,q])=>toNum(q)>0)
    .sort((a,b)=>{
      const ia=parseFloat(a[0]), ib=parseFloat(b[0]);
      if(!isNaN(ia)&&!isNaN(ib)) return ia-ib;
      if(!isNaN(ia)) return -1;
      if(!isNaN(ib)) return 1;
      return a[0].localeCompare(b[0]);
    });
  return entries.map(([s,q])=>`<span>${s} (${q})</span>`).join('');
}

function cardHTML(item, unitWholesale){
  const img = resolveImage(item.name, item.desc, item.colour);
  const hasImage = !img.includes('placeholder');
  return `
    <div class="card" data-hasimg="${hasImage?'1':'0'}">
      <div class="imgbox"><img src="${img}" alt="${item.name}" loading="lazy"
        onerror="this.replaceWith(Object.assign(document.createElement('div'),{className:'placeholder',innerHTML:'Photo<br>Coming Soon'}))"></div>
      <div class="body">
        <div class="title">${item.name}</div>
        <div class="muted">${[item.desc, item.colour].filter(Boolean).join(' ‚Ä¢ ')}</div>
        <div class="sizes"><strong>Sizes:</strong> ${sizesToChips(item.sizes) || '‚Äî'}</div>
        <div class="muted">Qty: ${item.qty || '‚Äî'}</div>
        <div class="price-line">
          <span class="tag">RRP: ${aud(item.rrpUnit)}</span>
          <span class="tag">Wholesale: ${aud(unitWholesale)}</span>
        </div>
      </div>
    </div>`;
}

/* MAIN */
(async function(){
  try{
    // Load CSV
    let txt=null, path=null;
    for(const p of CSV_CANDIDATES){
      const res = await fetch(p,{cache:'no-store'});
      if(res.ok){ txt = await res.text(); path=p; break; }
    }
    if(!txt) throw new Error('detailed_inventory.csv not found at repo root.');

    const {rows, header, sizeCols} = parseCSVAuto(txt);
    const valid = rows.filter(r=>norm(r.Item_Name));

    // Totals (use row RRP √ó qty to weight properly)
    const totalPieces = valid.reduce((s,r)=>s+toNum(r.Qty),0);
    const totalRRP = valid.reduce((s,r)=>s+(toNum(r.RRP_Unit)*toNum(r.Qty)),0);
    const items = aggregateItems(valid);
    const factorW = totalRRP>0 ? (WHOLESALE_TOTAL_TARGET_AUD/totalRRP) : 0;

    // Header
    document.getElementById('hero-pill').textContent =
      `${(totalPieces||0).toLocaleString()} pieces ‚Ä¢ ${items.length} SKUs`;
    document.getElementById('sum-pieces').textContent = `${(totalPieces||0).toLocaleString()} pieces`;
    document.getElementById('sum-skus').textContent   = `${items.length} SKUs`;
    document.getElementById('sum-rrp').textContent    = `Total RRP: ${aud(totalRRP)}`;
    document.getElementById('sum-wholesale').textContent= `Wholesale (target): ${aud(WHOLESALE_TOTAL_TARGET_AUD)}`;
    document.getElementById('sum-quick').textContent  = `Quick Sale (target): ${aud(QUICKSALE_TOTAL_TARGET_AUD)}`;

    // Size tiles (prefer wide columns; otherwise build from single Size)
    const totals = {};
    if(sizeCols.length){
      for(const r of rows){
        for(const [s,q] of Object.entries(r.SizesObj||{})){
          if(toNum(q)>0) totals[s] = (totals[s]||0)+toNum(q);
        }
      }
    }else{
      for(const r of rows){
        const s = Object.keys(r.SizesObj||{})[0];
        const q = Object.values(r.SizesObj||{})[0];
        if(s && toNum(q)>0) totals[s]=(totals[s]||0)+toNum(q);
      }
    }
    const ordered = Object.entries(totals).sort((a,b)=>{
      const ia=parseFloat(a[0]), ib=parseFloat(b[0]);
      if(!isNaN(ia)&&!isNaN(ib)) return ia-ib;
      if(!isNaN(ia)) return -1;
      if(!isNaN(ib)) return 1;
      return a[0].localeCompare(b[0]);
    });
    document.getElementById('size-tiles').innerHTML = ordered.map(([k,v])=>`
      <div class="size-tile"><b>${k}</b><span>${(v||0).toLocaleString()} pieces</span></div>
    `).join('');

    // Populate filters
    const uniq = arr => [...new Set(arr.filter(Boolean))];
    const allSizes = uniq(Object.keys(totals)).sort((a,b)=>{
      const ia=parseFloat(a), ib=parseFloat(b);
      if(!isNaN(ia)&&!isNaN(ib)) return ia-ib;
      if(!isNaN(ia)) return -1;
      if(!isNaN(ib)) return 1;
      return a.localeCompare(b);
    });
    document.getElementById('size').innerHTML =
      '<option value="">All Sizes</option>'+allSizes.map(s=>`<option>${s}</option>`).join('');
    document.getElementById('category').innerHTML =
      '<option value="">All Categories</option>'+uniq(valid.map(r=>norm(r.Category))).sort().map(s=>`<option>${s}</option>`).join('');

    // Render grid (photos first)
    const sizeSel = document.getElementById('size');
    const catSel  = document.getElementById('category');
    const qInput  = document.getElementById('q');

    function matchesQ(it,q){
      if(!q) return true;
      const hay=[it.name,it.desc,it.colour,it.category,it.subcat].join(' ').toLowerCase();
      return hay.includes(q.toLowerCase());
    }
    function hasSize(it, target){
      if(!target) return true;
      return toNum(it.sizes[target])>0;
    }
    function render(){
      const q=qInput.value.trim(), sz=sizeSel.value, cat=catSel.value;
      const filtered = items.filter(it => matchesQ(it,q) && hasSize(it,sz) && (!cat || lc(it.category)===lc(cat)));

      // Build HTML (real images first)
      filtered.sort((a,b)=>{
        const A = resolveImage(a.name,a.desc,a.colour).includes('placeholder')?0:1;
        const B = resolveImage(b.name,b.desc,b.colour).includes('placeholder')?0:1;
        return B-A;
      });

      document.getElementById('visible-count').textContent = filtered.length;
      document.getElementById('grid').innerHTML = filtered.map(it => {
        const unitWholesale = it.rrpUnit * factorW;
        return cardHTML(it, unitWholesale);
      }).join('') || '<div class="muted">No results.</div>';
    }
    qInput.addEventListener('input', render);
    sizeSel.addEventListener('change', render);
    catSel.addEventListener('change', render);
    render();

  }catch(err){
    console.error(err);
    document.getElementById('hero-pill').textContent='Could not load CSV';
    document.getElementById('grid').innerHTML='<div class="muted">Error loading products.</div>';
  }
})();
</script>
</body>
</html>
