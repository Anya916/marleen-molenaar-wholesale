<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marleen Molenaar — Wholesale Catalogue</title>
<style>
  :root{
    --bg:#f6f7fb;--card:#fff;--ink:#1b1b1b;--muted:#6a6a6a;--accent:#0a66ff;--border:#e6e6ee;--chip:#eef3ff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  /* Top proof ribbon */
  .proofbar{background:#0a66ff0d;border-bottom:1px solid var(--border)}
  .proofbar .wrap{max-width:1100px;margin:0 auto;padding:8px 16px;display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .proofbar a{font-size:13px;text-decoration:none;color:#0a66ff;border:1px solid #dfe7ff;background:#f4f7ff;padding:4px 8px;border-radius:999px}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);z-index:5}
  .wrap{max-width:1100px;margin:0 auto;padding:12px 16px}
  h1{font-size:20px;margin:0 0 6px}
  .metrics{display:flex;flex-wrap:wrap;gap:12px;font-size:14px;color:var(--muted)}
  .metrics b{color:var(--ink)}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .controls input,.controls select{padding:8px 10px;border:1px solid var(--border);border-radius:8px;background:#fff;font-size:14px}
  main{padding:18px 16px}
  .grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
  .imgbox{height:320px;background:#fff;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden}
  /* Force full garment visible, never cropped */
  .imgbox img{width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain;background:#fff}
  .placeholder{font-size:14px;color:var(--muted);text-align:center;line-height:1.3}
  .body{padding:12px;display:flex;flex-direction:column;gap:6px}
  .title{font-weight:600;margin:0}
  .muted{color:var(--muted);font-size:13px;line-height:1.35}
  .chips{display:flex;flex-wrap:wrap;gap:6px}
  .chip{background:var(--chip);color:#234;border:1px solid #dfe7ff;border-radius:999px;padding:2px 8px;font-size:12px}
  footer{padding:28px 16px;color:var(--muted);text-align:center}
</style>
</head>
<body>

<!-- Quality & Proof links bar (edit or add more links as you like) -->
<div class="proofbar">
  <div class="wrap">
    <span style="font-weight:600;font-size:13px;color:#0a3;">Quality & Proof:</span>
    <a href="detailed_inventory.csv" target="_blank">Inventory CSV</a>
    <a href="summary_metrics.json" target="_blank">Totals & Category Metrics</a>
    <a href="README.md" target="_blank">About the Collection</a>
  </div>
</div>

<header>
  <div class="wrap">
    <h1>Marleen Molenaar — Wholesale Catalogue</h1>
    <div class="metrics" id="metrics">
      <div><b id="m_units">—</b> pieces</div>
      <div><b id="m_skus">—</b> SKUs</div>
      <div><b id="m_boxes">50</b> boxes</div>
    </div>
    <div class="controls">
      <input id="q" placeholder="Search (brand, name, colour, size)…" />
      <select id="cat"><option value="">All categories</option></select>
      <select id="cond"><option value="">All conditions</option></select>
      <select id="size"><option value="">All sizes</option></select>
    </div>
  </div>
</header>

<main>
  <div class="grid" id="grid"></div>
</main>

<footer>
  <div>Vaucluse (Sydney NSW) — pickup only • All items brand new with tags</div>
</footer>

<script>
// -------- helpers --------
const $  = sel => document.querySelector(sel);
const normKey = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,'_');
const pick = (row, names) => {
  for (const n of names) {
    const k = normKey(n);
    for (const key in row) if (normKey(key)===k) return row[key];
  }
  return '';
};
const csvToRows = (text) => {
  const lines = text.replace(/\r/g,'').split('\n').filter(l=>l.trim());
  const head = lines.shift().split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(h=>h.replace(/^"|"$/g,'').trim());
  return lines.map(line=>{
    const cells = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'').trim());
    const o={}; head.forEach((h,i)=>o[h]=cells[i]??''); return o;
  });
};

// Guess images in this order:
// 1) Image_File column (if provided) → use as-is
// 2) images/<SKU>.jpg → .jpeg → .png
// 3) if SKU contains digits (e.g., MM_0012 → 12): images/image12_small.jpg
// 4) images/placeholder.webp
function imageCandidates(sku, imageFileFromCSV){
  const list = [];
  if (imageFileFromCSV) list.push(imageFileFromCSV);
  const S = (sku||'').trim();
  if (S) {
    list.push(`images/${S}.jpg`, `images/${S}.jpeg`, `images/${S}.png`);
    const digits = S.replace(/\D/g,'');
    if (digits) list.push(`images/image${parseInt(digits,10)}_small.jpg`);
  }
  list.push('images/placeholder.webp');
  return list;
}
function imgTagFor(sku, alt, imageFileFromCSV){
  const tries = imageCandidates(sku, imageFileFromCSV);
  return `<img src="${tries[0]}" alt="${alt}" data-try="0" onerror="
    const list='${tries.join('|')}'.split('|');
    let i=parseInt(this.dataset.try||'0',10)+1;
    if(i<list.length){ this.dataset.try=i; this.src=list[i]; }
    else { this.replaceWith(Object.assign(document.createElement('div'),{className:'placeholder',innerHTML:'Photo<br>Coming Soon'})); }
  ">`;
}

function cardHTML(p){
  const title = `${p.Brand||''} ${p.Item_Name||p.Item||p.Description||''}`.trim() || (p.SKU||'');
  const chips = [(p.Category||'').trim(),(p.Size||'').trim(),(p.Colour||p.Color||'').trim(),(p.Condition||'').trim()].filter(Boolean);
  const img   = imgTagFor((p.SKU||'').trim(), title || (p.SKU||''), p.Image_File);

  return `
  <div class="card">
    <div class="imgbox">${img}</div>
    <div class="body">
      <div class="title">${title}</div>
      <div class="muted">SKU: ${p.SKU||''}</div>
      <div class="chips">${chips.map(c=>`<span class="chip">${c}</span>`).join('')}</div>
      <div class="muted">Qty: ${p.Qty??'—'}</div>
      ${p.Wholesale_Price_AUD?`<div class="muted">Wholesale: $${(+p.Wholesale_Price_AUD).toFixed(2)}</div>`:''}
    </div>
  </div>`;
}

function matchesQ(p, q){
  if(!q) return true;
  const hay = [p.SKU,p.Brand,p.Item_Name,p.Item,p.Description,p.Category,p.Size,p.Colour,p.Color].join(' ').toLowerCase();
  return hay.includes(q.toLowerCase());
}
function matchesSel(v, sel){ return !sel || (v||'').toString().toLowerCase()===sel.toLowerCase(); }

(async function(){
  // 1) optional headline metrics
  try{
    const mRes = await fetch('summary_metrics.json');
    if (mRes.ok) {
      const m = await mRes.json();
      if (m?.TOTAL_UNITS) $('#m_units').textContent = (+m.TOTAL_UNITS).toLocaleString();
      if (m?.TOTAL_SKUS)  $('#m_skus').textContent  = (+m.TOTAL_SKUS).toLocaleString();
    }
  }catch(e){}

  // 2) load CSV
  const res = await fetch('detailed_inventory.csv');
  const text = await res.text();
  const rows = csvToRows(text);

  // 3) normalise fields
  const products = rows.map(r=>{
    const o={};
    o.SKU  = pick(r,['SKU','Sku','sku']);
    o.Brand= pick(r,['Brand']);
    o.Item_Name = pick(r,['Item_Name','Item Name','Item','Description','Title','Product']);
    o.Category  = pick(r,['Category']);
    o.Size      = pick(r,['Size']);
    o.Colour    = pick(r,['Colour','Color']);
    o.Condition = pick(r,['Condition']);
    o.Qty       = +((pick(r,['Qty','Quantity']))||0) || 0;
    o.Wholesale_Price_AUD = pick(r,['Wholesale_Price_AUD','Wholesale Price AUD','Wholesale']);
    o.Image_File = pick(r,['Image_File','Image File','Image','Image_URL','Image URL']); // optional
    return o;
  }).filter(p=>p.SKU);

  // 4) fill metrics if JSON not present
  if ($('#m_units').textContent==='—' || $('#m_skus').textContent==='—'){
    const units = products.reduce((s,p)=>s+(+p.Qty||0),0);
    $('#m_units').textContent = units.toLocaleString();
    $('#m_skus').textContent  = products.length.toLocaleString();
  }

  // 5) selectors
  const uniq = arr => [...new Set(arr.filter(Boolean))].sort((a,b)=>a.localeCompare(b));
  const setOpts = (sel, arr) => sel.innerHTML = '<option value="">All</option>'+arr.map(v=>`<option>${v}</option>`).join('');
  setOpts(document.getElementById('cat'),  uniq(products.map(p=>p.Category)));
  setOpts(document.getElementById('cond'), uniq(products.map(p=>p.Condition)));
  setOpts(document.getElementById('size'), uniq(products.map(p=>p.Size)));

  // 6) render with filters
  const render = ()=>{
    const q  = (document.getElementById('q').value||'').trim();
    const cat= document.getElementById('cat').value;
    const con= document.getElementById('cond').value;
    const siz= document.getElementById('size').value;
    const filtered = products.filter(p =>
      matchesQ(p,q) && matchesSel(p.Category,cat) && matchesSel(p.Condition,con) && matchesSel(p.Size,siz)
    );
    $('#grid').innerHTML = filtered.map(cardHTML).join('') || '<div class="muted" style="grid-column:1/-1">No results.</div>';
  };
  ['q','cat','cond','size'].forEach(id=>document.getElementById(id).addEventListener('input',render));
  render();
})();
</script>
</body>
</html>
