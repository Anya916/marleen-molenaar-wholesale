<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Marleen Molenaar Collection ‚Äî Wholesale Catalogue</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- PapaParse for CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --brand:#6A4FF6;           /* purple gradient start */
    --brand2:#8B69FF;          /* purple gradient end */
    --bg:#0f1125;
    --card:#ffffff;
    --muted:#6b7280;
    --chip:#eef2ff;
    --ok:#10b981;
    --shadow: 0 10px 30px rgba(23,16,84,.15);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:#f6f7fb;
    color:#0f172a;
  }
  .hero{
    background:linear-gradient(135deg,var(--brand),var(--brand2));
    color:#fff;
    padding:56px 20px 28px;
  }
  .container{max-width:1180px; margin:0 auto; padding:0 20px;}
  h1{margin:0 0 8px; font-size:40px; font-weight:800; letter-spacing:.2px;}
  .subtitle{opacity:.9; margin:0 0 20px; font-weight:600}
  .pill{
    display:inline-block; padding:10px 18px; border-radius:999px;
    background:rgba(255,255,255,.18); backdrop-filter:saturate(130%) blur(2px);
    border:1px solid rgba(255,255,255,.25); font-weight:700;
  }

  /* size chips row */
  .strip{
    background:#fff; margin-top:-18px; padding:18px; border-radius:22px;
    box-shadow: var(--shadow);
  }
  .strip h3{margin:6px 8px 14px; font-size:18px; color:#374151}
  .sizes{display:grid; grid-template-columns:repeat(auto-fit, minmax(130px,1fr)); gap:12px;}
  .sizebox{
    background:#faf7ff; border:1px solid #ece7ff; border-radius:14px; padding:14px 12px;
  }
  .sizebox b{display:block; color:#4c33ff; font-size:18px}
  .sizebox span{color:#6b6b82; font-size:14px}

  /* proof links */
  .proof{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:14px; margin:18px 0}
  .proof .card{background: #fff; border:1px solid #eef; border-radius:16px; padding:16px; box-shadow:var(--shadow)}
  .proof h4{margin:.2rem 0 .3rem}
  .proof p{margin:.2rem 0 0; color:#6b7280}

  /* toolbar */
  .toolbar{display:grid; grid-template-columns: 170px 200px 1fr; gap:10px; align-items:center; margin:18px 0}
  select, input[type="search"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb; background:#fff;
    font:inherit;
  }

  /* grid cards */
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:16px; margin:22px 0 50px}
  .card{
    background:var(--card); border:1px solid #ecebf8; border-radius:18px; overflow:hidden; box-shadow:var(--shadow)
  }
  .imgwrap{aspect-ratio: 4/3; background:#f4f4fb; display:flex; align-items:center; justify-content:center}
  .imgwrap img{max-width:100%; max-height:100%; display:block}
  .imgwrap .placeholder{color:#a1a1b3; font-size:14px}
  .body{padding:14px}
  .title{margin:2px 0 6px; font-weight:800}
  .muted{color:#6b7280; font-size:14px}
  .chips{margin:8px 0 2px; display:flex; flex-wrap:wrap; gap:6px}
  .chip{background:var(--chip); padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid #e6e6ff}
  .row{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
  .price{background:#f8fafc; border:1px dashed #e5e7eb; border-radius:10px; padding:6px 8px; font-size:13px}

  /* footer */
  footer{
    background:#111827; color:#e5e7eb; padding:36px 0; margin-top:50px;
  }
  .footgrid{display:grid; grid-template-columns: 1.2fr .8fr; gap:24px}
  footer h3{color:#93c5fd; margin:0 0 10px}
  .footgrid .summary{ text-align:right; }
  .summary b{display:block; font-size:20px}
  .badge{background:#1f2937; border:1px solid #374151; padding:8px 10px; border-radius:10px; display:inline-block; margin-top:6px}
  .totals{margin-top:6px; color:#9ca3af}
  .callout{color:#d1fae5}

  /* badges */
  .kicker{margin:20px 0 6px; color:#4b5563; font-weight:700}
  .kicker .emoji{margin-right:6px}

  /* hide debug line (older builds used this) */
  #debug, #totalsLine{display:none;}
</style>
</head>
<body>

<!-- HERO -->
<section class="hero">
  <div class="container">
    <h1>Marleen Molenaar Collection</h1>
    <p class="subtitle">Premium Children‚Äôs &amp; Ladies‚Äô Sleepwear ‚Äî Wholesale Catalogue</p>
    <div class="pill" id="heroPill">Loading‚Ä¶</div>
  </div>
</section>

<!-- SIZE BREAKDOWN -->
<div class="container">
  <div class="strip">
    <h3>üßµ Size Breakdown ‚Äî Pieces Available</h3>
    <div class="sizes" id="sizeBreak"></div>
  </div>

  <!-- PROOF LINKS -->
  <div class="kicker"><span class="emoji">üèÜ</span>Verified Luxury Credentials &amp; Proof Links</div>
  <div class="proof">
    <div class="card">
      <h4>Lane Crawford Luxury Retailer</h4>
      <a href="https://www.lanecrawford.com/brand/700351/marleen-molenaar-sleepwear/women" target="_blank">View Brand Page</a>
      <p>Hong Kong‚Äôs premier luxury department store ‚Äî equivalent to Harrods. Establishes brand positioning.</p>
    </div>
    <div class="card">
      <h4>Retail Pricing Evidence</h4>
      <a href="https://www.retykle.com/en-au/search?q=Marleen%20Molenaar" target="_blank">Retykle Pricing Proof</a>
      <p>Shows premium retail/resale pricing for individual pieces.</p>
    </div>
    <div class="card">
      <h4>Media Coverage</h4>
      <a href="https://www.scmp.com/article/533820/eastern-premise" target="_blank">South China Morning Post</a>
      <p>2006 profile: ‚Äúrunning a children‚Äôs clothing design company under her own name.‚Äù</p>
    </div>
  </div>

  <!-- TOOLS -->
  <div class="toolbar">
    <select id="sizeFilter">
      <option value="">All Sizes</option>
      <option>2</option><option>4</option><option>6</option><option>8</option>
      <option>10</option><option>12</option><option>14</option>
    </select>
    <select id="catFilter">
      <option value="">All Categories</option>
      <option>Children's</option>
      <option>Sleep/Lounge (Unisex)</option>
      <option>Ladies</option>
      <option>Outerwear</option>
    </select>
    <input id="searchBox" type="search" placeholder="Search name, colour, description" />
  </div>

  <!-- GRID -->
  <div id="grid" class="grid"></div>
</div>

<!-- FOOTER -->
<footer>
  <div class="container footgrid">
    <div>
      <h3>Contact Information</h3>
      <div class="badge"><b>Gary Flax:</b> +61 414 242 142</div><br>
      <div class="badge"><b>Location:</b> Vaucluse, Sydney NSW</div><br>
      <div class="badge"><b>Viewing:</b> Weekdays 5pm+, Weekends anytime</div><br>
      <div class="badge"><b>Brand:</b> Marleen Molenaar</div><br>
      <div class="badge"><b>Access:</b> Ground floor, driveway access for easy pickup</div>
    </div>
    <div class="summary">
      <h3>Collection Summary</h3>
      <div class="totals"><b id="sumPieces">0 pieces</b> across <b id="sumSKUs">0 SKUs</b></div>
      <div class="totals">Organized in <b>50</b> boxes for easy pickup</div>
      <div class="totals">Storage: Professional organization system</div>
      <div class="kicker" style="margin-top:10px;color:#93c5fd;">Pricing</div>
      <div class="badge"><b>Wholesale:</b> <span id="wholesaleTotal">‚Äî</span></div><br>
      <div class="badge callout"><b>Quick sale:</b> A$12,000</div>
    </div>
  </div>
</footer>

<script>
(function(){
  const CSV_URL = 'detailed_inventory.csv';
  const MAP_URL = 'image_map.csv';   // optional
  const IMG_PLACE = 'images/placeholder.webp';

  const SIZES = ['2','4','6','8','10','12','14'];

  // Safe number
  const toNum = v => {
    if (v===undefined || v===null) return 0;
    if (typeof v==='number') return v;
    const s = String(v).replace(/[^\d.\-]/g,'').trim();
    const n = parseFloat(s); return isNaN(n)?0:n;
  };

  // Load CSVs
  function loadCSV(url){
    return new Promise((resolve,reject)=>{
      Papa.parse(url, {
        download:true, header:true, skipEmptyLines:true,
        complete: (res)=> resolve(res.data),
        error: reject
      });
    });
  }

  function normalizeRow(r){
    // Accept either normalized rows (Size, Qty) OR wide columns per size (2,4,6..)
    const base = {
      sku: r.SKU || r.sku || '',
      brand: r.Brand || r.brand || 'Marleen Molenaar',
      name: r.Item_Name || r.Item || r['Item Name'] || r.name || '',
      desc: r.Description || r.description || '',
      category: r.Category || r.category || '',
      subcat: r.Subcategory || r.subcategory || '',
      colour: r.Colour || r.Color || r.colour || r.color || '',
      gender: r.Gender || r.gender || '',
      cond: r.Condition || r.condition || 'New',
      rrp: toNum(r['Anchor Price'] ?? r.RRP ?? r['Rrp'] ?? r['Retail'] ?? 0),
      wholesale: toNum(r['Discounted_Price'] ?? r['Wholesale'] ?? 0),
      size: (r.Size ?? r.size ?? '').toString().trim(),
      qty: toNum(r.Qty ?? r['Quantity'] ?? 0)
    };
    // If wide format:
    let hasWide = SIZES.some(s => (r[s] ?? '') !== '');
    if(hasWide){
      base.wide = {};
      SIZES.forEach(s => base.wide[s] = toNum(r[s]));
    }
    return base;
  }

  function aggregate(items){
    // key by (brand + name + desc + colour) => item-level aggregate
    const keyFor = o => [o.brand,o.name,o.desc,o.colour].join('|');
    const map = new Map();
    items.forEach(o=>{
      const k = keyFor(o);
      if(!map.has(k)){
        map.set(k,{
          brand:o.brand, name:o.name, desc:o.desc, colour:o.colour,
          category:o.category, subcat:o.subcat, gender:o.gender, cond:o.cond,
          sizes: { '2':0,'4':0,'6':0,'8':0,'10':0,'12':0,'14':0 },
          totalQty:0,
          rrpMin: Number.POSITIVE_INFINITY,
          rrpMax: 0,
          wholesaleMin: Number.POSITIVE_INFINITY,
          wholesaleMax: 0,
          skus: new Set()
        });
      }
      const agg = map.get(k);
      if(o.size){ if(agg.sizes[o.size]!==undefined) agg.sizes[o.size]+=o.qty; }
      if(o.wide){ SIZES.forEach(s=> agg.sizes[s]+= (o.wide[s]||0)); }
      agg.totalQty += o.qty || (o.wide ? SIZES.reduce((a,s)=>a+(o.wide[s]||0),0) : 0);
      if(o.rrp>0){ agg.rrpMin=Math.min(agg.rrpMin,o.rrp); agg.rrpMax=Math.max(agg.rrpMax,o.rrp); }
      if(o.wholesale>0){ agg.wholesaleMin=Math.min(agg.wholesaleMin,o.wholesale); agg.wholesaleMax=Math.max(agg.wholesaleMax,o.wholesale); }
      if(o.sku) agg.skus.add(o.sku);
    });
    return Array.from(map.values()).map(a=>{
      if(!isFinite(a.rrpMin)) a.rrpMin = 0;
      if(a.rrpMax===0) a.rrpMax = a.rrpMin;
      if(!isFinite(a.wholesaleMin)) a.wholesaleMin = 0;
      if(a.wholesaleMax===0) a.wholesaleMax = a.wholesaleMin;
      a.skuCount = a.skus.size;
      return a;
    });
  }

  function fmtAUD(n){
    try{
      return new Intl.NumberFormat('en-AU',{style:'currency',currency:'AUD',maximumFractionDigits:2}).format(n);
    }catch(e){ return 'A$'+(Math.round(n*100)/100).toLocaleString(); }
  }

  function createSizeBoxes(sizeTotals){
    const wrap = document.getElementById('sizeBreak');
    wrap.innerHTML = '';
    SIZES.forEach(s=>{
      const div = document.createElement('div');
      div.className = 'sizebox';
      div.innerHTML = `<b>Size ${s}</b><span>${(sizeTotals[s]||0).toLocaleString()} pieces</span>`;
      wrap.appendChild(div);
    });
  }

  function imgFor(item, imgMap){
    // 1) explicit mapping by exact Item Name if available
    if(imgMap && imgMap[item.name]){
      return 'images/' + imgMap[item.name];
    }
    // 2) keyword fallback
    const n = item.name.toLowerCase();
    const d = item.desc.toLowerCase();
    const text = n + ' ' + d + ' ' + (item.colour||'').toLowerCase();

    const tryName = (key, file)=> text.includes(key) ? ('images/'+file) : null;
    const candidates = [
      ['ella','image1_small.jpg'],
      ['cora','image2_small.jpg'],
      ['ava','image4_small.jpg'],
      ['harper','image5_small.jpg'],
      ['ruby','image6_small.jpg'],
      ['grace','image8_small.jpg'],
      ['isabella','image9_small.jpg'],
      ['mia','image10_small.jpg'],
      ['suzy','image11_small.jpg'],
      ['charlotte','image14_small.jpg'],
      ['eliana','image15_small.jpg'],
      ['jack','image17_small.jpg'],
      ['oliver','image18_small.jpg'],
      ['thomas','image19_small.jpg'],
      ['noah','image19_small.jpg'],
      ['maisie','image20_small.jpg'],
      ['olivia','image21_small.jpg'],
      ['aria','image22_small.jpg'],
      ['layla','image23_small.jpg'],
      ['sophia','image25_small.jpg'],
      ['summer','image26_small.jpg'],
      ['maya','image27_small.jpg'],
      ['josh','image28_small.jpg'],
      ['fireman','image30_small.jpg'],
      ['candy','image31_small.jpg'],
      ['knd','image32_small.jpg']
    ];
    for(const [k,f] of candidates){
      const hit = tryName(k,f);
      if(hit) return hit;
    }
    return IMG_PLACE;
  }

  function rrpLabel(a){
    if(a.rrpMin<=0 && a.rrpMax<=0) return '‚Äî';
    if(Math.abs(a.rrpMax - a.rrpMin) < 0.01) return fmtAUD(a.rrpMin) + ' AUD';
    return `from ${fmtAUD(a.rrpMin)} AUD`;
  }
  function whLabel(a){
    if(a.wholesaleMin<=0 && a.wholesaleMax<=0) return '‚Äî';
    if(Math.abs(a.wholesaleMax - a.wholesaleMin) < 0.01) return `${fmtAUD(a.wholesaleMin)} AUD`;
    return `from ${fmtAUD(a.wholesaleMin)} AUD`;
  }

  function renderGrid(items, imgMap){
    const grid = document.getElementById('grid');
    grid.innerHTML = '';

    // sort: items with real image first, then by name
    const withImgScore = (it)=> imgFor(it,imgMap)===IMG_PLACE ? 1 : 0;
    items.sort((a,b)=>{
      const s = withImgScore(a) - withImgScore(b);
      if(s!==0) return s;
      return (a.name||'').localeCompare(b.name||'');
    });

    items.forEach(a=>{
      const sizes = SIZES.filter(s => (a.sizes[s]||0)>0).map(s=>`<span class="chip"> ${s} √ó ${a.sizes[s]} </span>`).join('');
      const img = imgFor(a,imgMap);
      const haveImg = img && !img.endsWith('placeholder.webp');

      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        <div class="imgwrap">${ haveImg ? `<img loading="lazy" src="${img}" alt="${a.name}">` : `<div class="placeholder">Photo coming soon</div>` }</div>
        <div class="body">
          <div class="title">${a.name || '‚Äî'}</div>
          <div class="muted">${a.desc || ''}</div>
          <div class="muted">Colour: ${a.colour || '‚Äî'}</div>
          <div class="chips">${sizes || '<span class="chip">No sizes recorded</span>'}</div>
          <div class="row">
            <div class="price"><b>Qty:</b> ${a.totalQty.toLocaleString()}</div>
            <div class="price"><b>RRP:</b> ${rrpLabel(a)}</div>
            <div class="price"><b>Wholesale:</b> ${whLabel(a)}</div>
          </div>
        </div>`;
      grid.appendChild(el);
    });
  }

  function applyFilters(allItems){
    const q = (document.getElementById('searchBox').value||'').toLowerCase().trim();
    const size = document.getElementById('sizeFilter').value;
    const cat = document.getElementById('catFilter').value;

    return allItems.filter(a=>{
      if(size && (!a.sizes[size] || a.sizes[size]===0)) return false;
      if(cat && a.category !== cat) return false;
      if(q){
        const hay = [a.name,a.desc,a.colour,a.category,a.subcat].join(' ').toLowerCase();
        if(!hay.includes(q)) return false;
      }
      return true;
    });
  }

  Promise.all([loadCSV(CSV_URL).catch(()=>[]), loadCSV(MAP_URL).catch(()=>[])])
    .then(([rows, mapRows])=>{
      // build image map (Item Name -> filename)
      const imgMap = {};
      (mapRows||[]).forEach(r=>{
        const key = (r['Item Name']||r['Item_Name']||r['Item']||'').trim();
        const file = (r['Image']||'').trim();
        if(key && file) imgMap[key]=file;
      });

      // normalize + aggregate
      const normalized = rows.map(normalizeRow);

      // totals for sizes (global)
      const sizeTotals = {'2':0,'4':0,'6':0,'8':0,'10':0,'12':0,'14':0};
      normalized.forEach(n=>{
        if(n.wide){ SIZES.forEach(s=> sizeTotals[s]+= (n.wide[s]||0)); }
        if(n.size && sizeTotals[n.size]!==undefined){ sizeTotals[n.size]+= n.qty; }
      });

      const aggregated = aggregate(normalized);

      // hero totals
      const totalPieces = aggregated.reduce((a,b)=> a + (b.totalQty||0), 0);
      const totalSKUs = new Set(rows.map(r=> (r.SKU||r.sku||'') )).size;

      document.getElementById('heroPill').textContent =
        `${totalPieces.toLocaleString()} pieces ‚Ä¢ ${totalSKUs} SKUs ‚Ä¢ 50 boxes`;

      createSizeBoxes(sizeTotals);
      renderGrid(aggregated, imgMap);

      // footer totals (sum of wholesale min √ó qty as a conservative snapshot)
      const wholesaleSum = aggregated.reduce((a,b)=> a + ( (b.wholesaleMin||0) * (b.totalQty||0) ), 0);
      document.getElementById('sumPieces').textContent = `${totalPieces.toLocaleString()} pieces`;
      document.getElementById('sumSKUs').textContent = `${totalSKUs.toLocaleString()} SKUs`;
      document.getElementById('wholesaleTotal').textContent = fmtAUD(wholesaleSum);

      // filters wiring
      const all = aggregated.slice();
      const doUpdate = ()=>{
        const filtered = applyFilters(all);
        renderGrid(filtered, imgMap);
      };
      document.getElementById('searchBox').addEventListener('input', doUpdate);
      document.getElementById('sizeFilter').addEventListener('change', doUpdate);
      document.getElementById('catFilter').addEventListener('change', doUpdate);
    })
    .catch(err=>{
      console.error(err);
      document.getElementById('grid').innerHTML =
        `<div class="muted">Error loading products. Please check the data files.</div>`;
    });

})();
</script>
</body>
</html>
