<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Marleen Molenaar Collection â€” Wholesale Catalogue</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --ink:#0e1025; --ink2:#4b4f69; --muted:#8b92a7;
  --brand1:#6f4cf6; --brand2:#9b66ff; --chip:#eef0fb; --border:#e7e8f1; --shadow:0 10px 26px rgba(25,26,54,.08);
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
a{color:#4e5bff;text-decoration:none;font-weight:600}
.header{
  padding:56px 20px 110px;
  background:radial-gradient(1100px 520px at 15% -10%,rgba(255,255,255,.35),transparent),
             linear-gradient(135deg,var(--brand1),var(--brand2));
  color:#fff;
}
.wrap{max-width:1160px;margin:0 auto}
.h1{font-size:clamp(34px,5vw,64px);font-weight:800;letter-spacing:.2px;margin:0 0 10px}
.tag{display:inline-block;margin-top:16px;padding:10px 16px;border-radius:999px;background:rgba(255,255,255,.16);backdrop-filter:blur(3px);font-weight:700}
.panel{margin-top:-70px}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px; padding:18px; box-shadow:var(--shadow); margin:16px 0}
.grid7{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
@media (max-width:980px){.grid7{grid-template-columns:repeat(3,1fr)}}
@media (max-width:620px){.grid7{grid-template-columns:repeat(2,1fr)}}
.sizepill{background:#fafbff;border:1px solid var(--border);border-radius:14px;padding:14px;text-align:center}
.sizepill b{font-size:20px}
.kvgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
@media (max-width:980px){.kvgrid{grid-template-columns:1fr}}
.kv{padding:16px;border:1px solid var(--border);border-radius:14px;background:#fff}
.kv h4{margin:0 0 6px;font-size:16px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
select,input{height:40px;padding:0 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-weight:600}
.gridCards{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
@media (max-width:980px){.gridCards{grid-template-columns:repeat(2,1fr)}}
@media (max-width:650px){.gridCards{grid-template-columns:1fr}}
.item{background:#fff;border:1px solid var(--border);border-radius:20px;overflow:hidden;box-shadow:var(--shadow)}
.pic{background:#f4f5fa;height:260px;display:flex;align-items:center;justify-content:center}
.pic img{max-width:95%;max-height:95%;object-fit:contain}
.meta{padding:16px 18px 18px}
.meta h3{margin:0 0 4px;font-size:20px}
.sub{color:var(--ink2);font-size:14px;margin-bottom:10px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:var(--chip);border:1px dashed var(--border);padding:5px 10px;border-radius:999px;font-size:12px;font-weight:700;color:#2b3159}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.badge{background:#f6f7fb;border:1px solid var(--border);border-radius:999px;padding:6px 12px;font-weight:700}
.empty{padding:16px;color:#8a90a7}
.footer{background:#0f1129;color:#eaf0ff;margin-top:28px}
.footer .wrap{display:grid;grid-template-columns:1fr 1fr;gap:18px;padding:26px 20px}
@media (max-width:820px){.footer .wrap{grid-template-columns:1fr}}
.footCard{background:#161b33;border-radius:18px;padding:18px 20px}
.footCard h3{color:#aeb8ff;margin:0 0 10px}
</style>
</head>
<body>
<header class="header">
  <div class="wrap">
    <h1 class="h1">Marleen Molenaar Collection</h1>
    <div id="heroPill" class="tag">Loadingâ€¦</div>
  </div>
</header>

<main class="wrap panel">
  <!-- Size breakdown -->
  <section class="card">
    <h2 style="margin:0 0 10px">ðŸ§µ Size Breakdown â€” Pieces Available</h2>
    <div id="sizes" class="grid7"></div>
  </section>

  <!-- Filters + Grid -->
  <section class="card">
    <div class="controls">
      <select id="sizeFilter">
        <option value="">All Sizes</option>
        <option>2</option><option>4</option><option>6</option><option>8</option>
        <option>10</option><option>12</option><option>14</option>
      </select>
      <select id="catFilter">
        <option value="">All Categories</option>
        <option>Children's</option><option>Ladies</option><option>Boys</option><option>Baby</option><option>Unisex</option>
      </select>
      <input id="search" type="search" placeholder="Search name, colour, description" />
    </div>

    <div id="grid" class="gridCards"></div>
    <div id="empty" class="empty" style="display:none">No results.</div>

    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:14px">
      <div class="badge"><strong>Wholesale:</strong> <span id="sumWholesale">â€”</span></div>
      <div class="badge"><strong>Quick sale:</strong> <span id="sumQuick">A$12,000.00</span></div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="wrap">
    <div class="footCard">
      <h3>Contact Information</h3>
      <p><strong>Gary Flax:</strong> +61 414 242 142<br>
         <strong>Location:</strong> Vaucluse, Sydney NSW<br>
         <strong>Viewing:</strong> Weekdays 5pm+, Weekends anytime<br>
         <strong>Brand:</strong> Marleen Molenaar<br>
         <strong>Access:</strong> Ground floor, driveway access for easy pickup</p>
    </div>
    <div class="footCard">
      <h3>Collection Summary</h3>
      <p><span id="sumPieces">â€”</span> pieces across <span id="sumSkus">â€”</span> SKUs</p>
    </div>
  </div>
</footer>

<script>
/* ---------------- CSV + JSON helpers (quote-safe) ---------------- */
function parseCSV(text){
  const rows=[]; const lines=text.replace(/\r/g,"").split("\n");
  if(!lines.length) return rows;
  const head = splitCSVLine(lines.shift()).map(h=>h.trim());
  for(const line of lines){
    if(!line || !line.trim()) continue;
    const cells = splitCSVLine(line);
    const obj={};
    head.forEach((h,i)=> obj[h]=cells[i]!==undefined?cells[i]:"");
    rows.push(obj);
  }
  return rows;
}
function splitCSVLine(s){
  const out=[]; let cur=""; let q=false;
  for(let i=0;i<s.length;i++){
    const c=s[i];
    if(c=='"'){ if(q && s[i+1]=='"'){ cur+='"'; i++; } else { q=!q; } }
    else if(c=="," && !q){ out.push(cur); cur=""; }
    else cur+=c;
  }
  out.push(cur);
  return out;
}
async function fetchCSV(url){ const r=await fetch(url+'?t='+Date.now()); if(!r.ok) throw new Error(url+': '+r.status); return parseCSV(await r.text()); }
async function fetchJSON(url){ const r=await fetch(url+'?t='+Date.now()); if(!r.ok) throw new Error(url+': '+r.status); return await r.json(); }

/* ---------------- Formatting ---------------- */
const moneyAU = v => new Intl.NumberFormat('en-AU',{style:'currency',currency:'AUD'}).format(+v||0);
const fmtInt  = v => (+v||0).toLocaleString('en-AU');
const lc = s => (s||'').toString().trim().toLowerCase();

/* ---------------- Config (filenames as you have them) ---------------- */
const INV_URL='detailed_inventory.csv'; // wide file
const MAP_URL='image_map.csv';          // columns: image,name
const METRICS_URL='summary_metrics.json';
const PLACEHOLDER='images/placeholder.webp';
const QUICK_SALE_TARGET = 12000;

/* ---------------- App state ---------------- */
let INVENTORY=[], IMAGE_MAP=[], METRICS=null;

/* ---------------- Image matching ----------------
   Priority: exact name match -> contains match (case-insensitive)
   Multiple images per name: first wins (stable order from CSV).
--------------------------------------------------*/
function buildImageMatchers(rows){
  const exact = new Map();   // name -> image
  const list  = [];          // [{nameLC,image}]
  for(const r of rows){
    const name=(r.name||'').trim(); const image=(r.image||'').trim();
    if(!name || !image) continue;
    const nlc = lc(name);
    if(!exact.has(nlc)) exact.set(nlc, image);
    list.push({nameLC:nlc, image});
  }
  return { exact, list };
}
function pickImageFor(itemName, matchers){
  const n = lc(itemName);
  if(!n) return '';
  // exact
  if(matchers.exact.has(n)) return matchers.exact.get(n);
  // contains: choose the first pattern whose name is contained in itemName
  for(const m of matchers.list){
    if(n.includes(m.nameLC)) return m.image;
  }
  return '';
}

/* ---------------- Inventory helpers ---------------- */
function coerceWideRow(r){
  // numeric fields
  const num = k => Number((r[k]??'').toString().replace(/[^\d.\-]/g,''))||0;
  const sizes = {2:num('size2'),4:num('size4'),6:num('size6'),8:num('size8'),
                 10:num('size10'),12:num('size12'),14:num('size14')};
  const total = num('total_qty') || Object.values(sizes).reduce((a,b)=>a+b,0);
  return {
    sku: r.sku||'',
    brand: r.brand||'',
    item_name: r.item_name||'',
    description: r.description||'',
    category: r.category||'',
    subcategory: r.subcategory||'',
    gender: r.gender||'',
    condition: r.condition||'',
    colour: r.colour||'',
    rrp: num('rrp'),
    sizes,
    size2: sizes[2], size4: sizes[4], size6: sizes[6], size8: sizes[8],
    size10: sizes[10], size12: sizes[12], size14: sizes[14],
    qty: total,
    wholesale_price: 0 // you can compute a factor if you wish
  };
}

/* ---------------- Rendering ---------------- */
function sizePills(r){
  const out=[];
  [[2,'size2'],[4,'size4'],[6,'size6'],[8,'size8'],[10,'size10'],[12,'size12'],[14,'size14']].forEach(([n,k])=>{
    const v=+r[k]||0; if(v>0) out.push(`<span class="chip">${n}Ã—${v}</span>`);
  });
  return out.join('');
}

function renderMetricsFromJSON(metrics){
  // Headline
  const pieces = metrics.total_pieces||0;
  const skus   = metrics.distinct_items||0;
  document.getElementById('heroPill').textContent = `${fmtInt(pieces)} pieces â€¢ ${fmtInt(skus)} SKUs`;
  document.getElementById('sumPieces').textContent = fmtInt(pieces);
  document.getElementById('sumSkus').textContent   = fmtInt(skus);

  // Size tiles
  const sizes = metrics.sizes||{};
  const order = [2,4,6,8,10,12,14];
  document.getElementById('sizes').innerHTML =
    order.map(s=>`
      <div class="sizepill"><b>Size ${s}</b><span class="sub">${fmtInt(sizes[String(s)]||0)} pieces</span></div>
    `).join('');
}

function renderMetricsFromInventory(rows){
  const pieces = rows.reduce((a,b)=>a+(+b.qty||0),0);
  const skus   = rows.length;
  document.getElementById('heroPill').textContent = `${fmtInt(pieces)} pieces â€¢ ${fmtInt(skus)} SKUs`;
  document.getElementById('sumPieces').textContent = fmtInt(pieces);
  document.getElementById('sumSkus').textContent   = fmtInt(skus);

  const totals={2:0,4:0,6:0,8:0,10:0,12:0,14:0};
  rows.forEach(r=>{
    totals[2]+=r.size2; totals[4]+=r.size4; totals[6]+=r.size6; totals[8]+=r.size8;
    totals[10]+=r.size10; totals[12]+=r.size12; totals[14]+=r.size14;
  });
  document.getElementById('sizes').innerHTML =
    [2,4,6,8,10,12,14].map(s=>`
      <div class="sizepill"><b>Size ${s}</b><span class="sub">${fmtInt(totals[s])} pieces</span></div>
    `).join('');
}

function renderList(rows, matchers){
  const grid=document.getElementById('grid');
  const empty=document.getElementById('empty');

  // Filters
  const size = document.getElementById('sizeFilter').value;
  const cat  = document.getElementById('catFilter').value;
  const q    = document.getElementById('search').value.trim().toLowerCase();

  const filtered = rows.filter(r=>{
    if(size && (+r['size'+size]||0)===0) return false;
    if(cat && r.category!==cat && r.subcategory!==cat) return false;
    if(q){
      const hay=(r.item_name+' '+r.description+' '+r.colour+' '+r.category+' '+r.subcategory).toLowerCase();
      if(!hay.includes(q)) return false;
    }
    return true;
  });

  // Image selection (exact â†’ contains)
  const prepared = filtered.map(r=>{
    const img = pickImageFor(r.item_name, matchers) || PLACEHOLDER;
    return {...r, __img:img, __miss: img===PLACEHOLDER?1:0};
  }).sort((a,b)=> a.__miss-b.__miss || (a.item_name||'').localeCompare(b.item_name||''));

  grid.innerHTML = prepared.map(r=>`
    <article class="item">
      <div class="pic">${r.__img?`<img src="${r.__img}" alt="${r.item_name}">`:`<div style="color:#94a3b8">Photo Coming Soon</div>`}</div>
      <div class="meta">
        <h3>${r.item_name||'â€”'}</h3>
        <div class="sub">${[r.description, r.colour].filter(Boolean).join(' â€¢ ')}</div>
        <div class="chips">${sizePills(r)}</div>
        <div class="row">
          <div class="badge"><strong>Qty:</strong>&nbsp;${fmtInt(r.qty||0)}</div>
          <div class="badge"><strong>RRP:</strong>&nbsp;${r.rrp?moneyAU(r.rrp):'â€”'}</div>
        </div>
      </div>
    </article>
  `).join('');

  empty.style.display = prepared.length ? "none" : "";
}

/* ---------------- Boot ---------------- */
async function start(){
  try{
    // Load all sources (JSON is optional)
    const [invRows, mapRows] = await Promise.all([
      fetchCSV(INV_URL),
      fetchCSV(MAP_URL)
    ]).catch(e=>{ throw e; });

    // Try metrics JSON; if it fails, we compute later
    try{ METRICS = await fetchJSON(METRICS_URL); } catch(e){ METRICS = null; }

    // Build matchers from image map
    IMAGE_MAP = mapRows;
    const matchers = buildImageMatchers(IMAGE_MAP);

    // Coerce inventory
    INVENTORY = invRows.map(coerceWideRow);

    // Render metrics
    if(METRICS && typeof METRICS.total_pieces === 'number'){
      renderMetricsFromJSON(METRICS);
    } else {
      renderMetricsFromInventory(INVENTORY);
    }

    // Wholesale totals (naive example: set wholesale as 40% of RRP per unit)
    const WHOLESALE_FACTOR = 0.4;
    const withWholesale = INVENTORY.map(r => ({...r, wholesale_price: (r.rrp||0)*WHOLESALE_FACTOR }));
    const wholesaleTotal = withWholesale.reduce((a,r)=> a + (r.wholesale_price||0)*(r.qty||0), 0);
    document.getElementById('sumWholesale').textContent = moneyAU(wholesaleTotal);
    document.getElementById('sumQuick').textContent     = moneyAU(QUICK_SALE_TARGET);

    // Set up filters
    const rerender = ()=> renderList(withWholesale, matchers);
    ['sizeFilter','catFilter','search'].forEach(id=>{
      const el=document.getElementById(id);
      el.addEventListener('input',rerender); el.addEventListener('change',rerender);
    });
    rerender();

  }catch(err){
    console.error(err);
    document.getElementById('heroPill').textContent = 'Load error â€” check filenames & local server';
    document.getElementById('grid').innerHTML = '<div class="empty">Could not load data. Ensure index.html, detailed_inventory.csv, image_map.csv, and summary_metrics.json are in the same folder.</div>';
  }
}
start();
</script>
</body>
</html>
