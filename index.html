<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Marleen Molenaar Collection ‚Äî Wholesale Catalogue</title>
<meta name="description" content="Premium children's & ladies' sleepwear wholesale catalogue ‚Äî Marleen Molenaar. All items new with tags.">

<style>
  :root{ --purple1:#667eea; --purple2:#764ba2; --bg:#f5f5fb; --card:#fff; --ink:#1d1b2e; --muted:#6d5e85; --border:#e8e6f3; --chip:#efe9ff; --tint:#f6f1ff; --link:#1a5cff; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);}
  .hero{background:linear-gradient(135deg,var(--purple1),var(--purple2));color:#fff;text-align:center;padding:42px 16px 36px;box-shadow:inset 0 -1px 0 rgba(255,255,255,.25)}
  .hero h1{font-size:44px;line-height:1.1;margin:0 0 8px;font-weight:800}
  .hero p{margin:0 0 16px;opacity:.95;font-size:18px}
  .pill{display:inline-block;padding:10px 18px;border-radius:999px;background:rgba(255,255,255,.22);border:1px solid rgba(255,255,255,.35);backdrop-filter:blur(8px);font-weight:700}
  .wrap{max-width:1200px;margin:0 auto;padding:0 16px}
  .panel{background:var(--card);border:1px solid var(--border);border-radius:14px;margin:18px auto;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .panel h3{margin:0 0 10px;font-size:18px;color:#2a1a47;display:flex;align-items:center;gap:8px}
  .size-tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px}
  .size-tile{background:var(--tint);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;box-shadow:inset 0 -1px 0 #efeaff}
  .size-tile b{display:block;font-size:22px;color:#2a1a47}
  .size-tile span{display:block;font-size:13px;color:var(--muted);margin-top:4px}
  .proof{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .proof-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:inset 0 -1px 0 #efeaff}
  .proof-card h4{margin:0 0 6px;color:#2a1a47}
  .proof-card a{color:var(--link);text-decoration:none;font-weight:600}
  .proof-card p{margin:6px 0 0;color:#6d5e85;font-size:14px}
  .filters{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin:18px 0;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .filters label{display:block;font-size:13px;color:#4b4267;margin-bottom:4px}
  .filters input,.filters select{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;min-width:200px}
  .filters .meta{margin-top:10px;color:var(--muted);font-size:14px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;margin-bottom:28px}
  .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.06)}
  .imgbox{height:180px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .imgbox img{max-width:100%;max-height:100%;width:auto;height:auto;object-fit:contain;background:#fff}
  .placeholder{font-size:14px;color:#999;text-align:center}
  .body{padding:12px}
  .title{font-weight:800;color:#2a1a47;margin:0 0 6px}
  .muted{color:#6d5e85;font-size:13px}
  .chips{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
  .chip{background:var(--chip);color:#2a1a47;border:1px solid #e5d9ff;border-radius:999px;padding:2px 8px;font-size:12px}
  .sizes{margin-top:4px}
  .sizes span{background:#f4f0ff;border:1px solid #dccfff;border-radius:6px;padding:2px 6px;margin:2px;display:inline-block;font-size:12px}
  .price-line{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
  .price-line .tag{background:#f4f0ff;border:1px solid #dccfff;border-radius:6px;padding:2px 8px;font-size:12px}
  .footer{background:#1f1640;color:#fff;margin-top:10px}
  .footer-inner{max-width:1200px;margin:0 auto;padding:22px 16px;display:flex;flex-wrap:wrap;gap:22px;justify-content:space-between}
  .footer h4{margin:0 0 8px}
  .footer a{color:#fff;text-decoration:none}
  .fine{color:#c9c4e6;font-size:13px}
  .warn{color:#b00020;font-weight:600}
</style>
</head>
<body>

  <!-- HERO -->
  <section class="hero">
    <div class="wrap">
      <h1>Marleen Molenaar Collection</h1>
      <p>Premium Children‚Äôs & Ladies‚Äô Sleepwear ‚Äî Wholesale Catalogue</p>
      <div class="pill" id="hero-pill">Loading totals‚Ä¶</div>
    </div>
  </section>

  <div class="wrap">

    <!-- SIZE BREAKDOWN -->
    <div class="panel">
      <h3>üßµ Size Breakdown ‚Äî Pieces Available</h3>
      <div class="size-tiles" id="size-tiles"></div>
    </div>

    <!-- VERIFIED CREDENTIALS & PROOF LINKS -->
    <div class="panel">
      <h3>üèÜ Verified Luxury Credentials & Proof Links</h3>
      <div class="proof">
        <div class="proof-card">
          <h4>Lane Crawford Luxury Retailer</h4>
          <a href="https://www.lanecrawford.com/brand/700351/marleen-molenaar-sleepwear/women" target="_blank" rel="noopener">
            View Brand Page
          </a>
          <p>Hong Kong‚Äôs premier luxury department store ‚Äî equivalent to Harrods. Establishes brand positioning.</p>
        </div>
        <div class="proof-card">
          <h4>Retail Pricing Evidence</h4>
          <a href="https://retykle.com/products/marleen-molenaar-pyjama-set-2-8y" target="_blank" rel="noopener">
            Retykle Pricing Proof
          </a>
          <p>Shows premium retail/resale pricing for individual pieces.</p>
        </div>
        <div class="proof-card">
          <h4>Media Coverage</h4>
          <a href="https://www.scmp.com/article/533820/eastern-premise" target="_blank" rel="noopener">
            South China Morning Post
          </a>
          <p>2006 profile: ‚Äúrunning a children‚Äôs clothing design company under her own name.‚Äù</p>
        </div>
      </div>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <div class="row">
        <div>
          <label for="size">Size</label>
          <select id="size"><option value="">All Sizes</option></select>
        </div>
        <div>
          <label for="category">Category</label>
          <select id="category"><option value="">All Categories</option></select>
        </div>
        <div style="flex:1 1 280px">
          <label for="q">Search</label>
          <input id="q" placeholder="Search name, colour, description‚Ä¶">
        </div>
      </div>
      <div class="meta">
        <div>Showing <b id="visible-count">0</b> items</div>
        <div id="totals-note">Totals auto-update from CSV</div>
        <div id="diag" class="muted"></div>
      </div>
    </div>

    <!-- PRODUCT GRID -->
    <div class="grid" id="grid"></div>

  </div>

  <!-- FOOTER / OWNER + SUMMARY -->
  <footer class="footer">
    <div class="footer-inner">
      <div>
        <h4>Contact</h4>
        <p><strong>Gary Flax:</strong> <a href="tel:+61414242142">+61 414 242 142</a></p>
        <p><strong>Location:</strong> Vaucluse, Sydney NSW</p>
        <p><strong>Viewing:</strong> Weekdays 5pm+, Weekends anytime</p>
        <p><strong>Brand:</strong> Marleen Molenaar</p>
        <p class="fine">All items new with original manufacturer tags.</p>
      </div>
      <div>
        <h4>Collection Summary</h4>
        <p id="sum-pieces">‚Äî pieces</p>
        <p id="sum-skus">‚Äî SKUs</p>
        <p id="sum-rrp">Total RRP: ‚Äî AUD</p>
        <p><strong id="sum-wholesale">Wholesale (target): ‚Äî AUD</strong></p>
        <p><strong id="sum-quick">Quick Sale (target): ‚Äî AUD</strong></p>
      </div>
    </div>
  </footer>

<script>
/* ================= CONFIG (edit these as needed) ================= */
const WHOLESALE_TOTAL_TARGET_AUD = 20000;   // e.g., 18000‚Äì22000
const QUICKSALE_TOTAL_TARGET_AUD  = 12000;  // shown as collection total only
const CSV_CANDIDATES = [
  'detailed_inventory.csv',
  'detailed_inventory (1).csv',
  'Detailed_Inventory.csv'
];

/* ================= Helpers ================= */
const norm=s=> (s||'').toString().trim();
const lc  =s=> norm(s).toLowerCase();
const toNum = x => { if(x==null) return 0; const s=String(x).replace(/[^\d.,-]/g,'').replace(/,/g,''); return parseFloat(s)||0; };
const aud = v => isFinite(v) ? `\$${v.toFixed(2)} AUD` : '‚Äî';

/* ================= CSV loader with delimiter auto-detect ================= */
function detectDelimiter(text){
  const first = text.split(/\r?\n/).find(l=>l.includes(',')||l.includes(';')||l.includes('\t')) || '';
  const counts = { ',':(first.match(/,/g)||[]).length, ';':(first.match(/;/g)||[]).length, '\t':(first.match(/\t/g)||[]).length };
  return Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0] || ',';
}
function splitRow(line, delim){
  const re = new RegExp(`("([^"]|"")*"|[^${delim}]+)`, 'g');
  return (line.match(re)||[]).map(s=>s.replace(/^"|"$/g,'').replace(/""/g,'"').trim());
}
function parseCSVAuto(text){
  const delim = detectDelimiter(text);
  const lines = text.replace(/\r/g,'').split('\n').filter(l=>l.trim());
  const header = splitRow(lines.shift(), delim);
  const colsLC = header.map(h=>h.toLowerCase());
  const idx = name => colsLC.indexOf(name);

  const map = {
    sku: idx('sku'),
    brand: idx('brand'),
    item: idx('item_name'),
    desc: idx('description'),
    category: idx('category'),
    subcat: idx('subcategory'),
    size: idx('size'),
    colour: idx('colour')!==-1?idx('colour'):idx('color'),
    gender: idx('gender'),
    condition: idx('condition'),
    qty: idx('qty'),
    rrp: idx('anchor_price'),
    discounted: idx('discounted_price'),
    channel: idx('channel')
  };

  const rows = lines.map(line=>{
    const cells = splitRow(line, delim);
    const get = i => (i>=0 ? (cells[i]||'') : '');
    return {
      SKU: get(map.sku),
      Brand: get(map.brand),
      Item_Name: get(map.item),
      Description: get(map.desc),
      Category: get(map.category),
      Subcategory: get(map.subcat),
      Size: get(map.size),
      Colour: get(map.colour),
      Gender: get(map.gender),
      Condition: get(map.condition),
      Qty: get(map.qty),
      Anchor_Price: get(map.rrp),
      Discounted_Price: get(map.discounted),
      Channel: get(map.channel),
      _delim: delim,
      _map: map
    };
  });
  return { rows, header, map, delim };
}

async function loadCSV(){
  let lastErr;
  for (const path of CSV_CANDIDATES){
    try{
      const res = await fetch(path, {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const txt = await res.text();
      const parsed = parseCSVAuto(txt);
      return {...parsed, path};
    }catch(e){ lastErr = e; }
  }
  throw lastErr || new Error('CSV not found');
}

/* ================= Grouping & Aggregation ================= */
/* Key per product card: Item_Name + Colour + Subcategory */
function keyOf(r){ return [r.Item_Name, r.Colour, r.Subcategory].map(v=>lc(v||'')).join(' ‚Ä¢ '); }

function aggregateItems(rows){
  const groups = new Map();
  for(const r of rows){
    const name = norm(r.Item_Name);
    if(!name) continue;
    const qty = toNum(r.Qty);
    const rrp = toNum(r.Anchor_Price);
    const key = keyOf(r);

    if(!groups.has(key)){
      groups.set(key, {
        Item_Name: name,
        Colour: norm(r.Colour),
        Subcategory: norm(r.Subcategory),
        Description: norm(r.Description),
        Category: norm(r.Category),
        sizes: {},         // { '2': count, '4': count, ... or text sizes too }
        totalQty: 0,
        rrps: {},          // frequency map of unit RRP to pick the "mode"
        rrpsSeen: [],      // list to compute fallback average
      });
    }
    const g = groups.get(key);

    // size -> qty
    const sz = norm(r.Size);
    if(sz){ g.sizes[sz] = (g.sizes[sz]||0) + qty; }

    // totals
    g.totalQty += qty;

    // rrp mode calc
    if(rrp>0){
      g.rrps[rrp] = (g.rrps[rrp]||0)+qty;
      g.rrpsSeen.push(rrp);
    }

    // keep a better description if current is empty and this row has more info
    if(!g.Description && r.Description) g.Description = norm(r.Description);
  }

  // finalize array
  const result = [];
  for(const g of groups.values()){
    // pick RRP mode (price with highest count); fallback to average
    let unitRRP = 0, bestCount = -1;
    for(const [priceStr,count] of Object.entries(g.rrps)){
      const price = Number(priceStr);
      if(count>bestCount){ bestCount=count; unitRRP=price; }
    }
    if(unitRRP<=0 && g.rrpsSeen.length){
      unitRRP = g.rrpsSeen.reduce((a,b)=>a+b,0)/g.rrpsSeen.length;
    }
    result.push({
      name: g.Item_Name,
      colour: g.Colour,
      subcat: g.Subcategory,
      desc: g.Description,
      category: g.Category,
      sizes: g.sizes,
      qty: g.totalQty,
      rrpUnit: unitRRP
    });
  }
  return result;
}

/* ================= Image rules (keyword-based) ================= */
const IMAGE_RULES = [
  // 1‚Äì11 (corrected)
  { image:"images/image1_small.jpg",  keywords:["ella","princess","gown","pink"] },
  { image:"images/image2_small.jpg",  keywords:["cora","sleeveless","short","flower","blue"] },
  { image:"images/image2_small.jpg",  keywords:["cora","sleeveless","short","flower","light","blue"] },
  { image:"images/image3_small.jpg",  keywords:["cora","sleeveless","short","flower","pink"] },
  { image:"images/image4_small.jpg",  keywords:["ava","singlet","top","pants","green","yellow"] },
  { image:"images/image5_small.jpg",  keywords:["harper","shorts","vest","lemon"] },
  { image:"images/image5_small.jpg",  keywords:["harper","shorts","vest","green"] },
  { image:"images/image6_small.jpg",  keywords:["ruby","pyjama","boob","tube","short","pink"] },
  { image:"images/image7_small.jpg",  keywords:["ella","semi","pajama","pink"] },
  { image:"images/image8_small.jpg",  keywords:["grace","nightie","bow","off-white","organic"] },
  { image:"images/image9_small.jpg",  keywords:["isabella","nightdress","check","blue"] },
  { image:"images/image9_small.jpg",  keywords:["isabella","nightdress","check","pink"] },
  { image:"images/image10_small.jpg", keywords:["mia","shirt","long","sleeve","blue"] },
  { image:"images/image10_small.jpg", keywords:["mia","shirt","lilac"] },
  { image:"images/image11_small.jpg", keywords:["ella","suzy","90","pink"] },
  // 12‚Äì19
  { image:"images/image12_small.jpg", keywords:["suzy","90","pink"] },
  { image:"images/image13_small.jpg", keywords:["suzy","90","pink"] },
  { image:"images/image14_small.jpg", keywords:["charlotte","suzy","90","blue"] },
  { image:"images/image15_small.jpg", keywords:["eliana","suzy","90","sleeveless","lemon","flower"] },
  { image:"images/image16_small.jpg", keywords:["cora","suzy","90","night","sleeveless","flower","blue"] },
  { image:"images/image17_small.jpg", keywords:["jack","boy","paj","blue","brown"] },
  { image:"images/image18_small.jpg", keywords:["oliver","gary","long","paj","black","check"] },
  { image:"images/image19_small.jpg", keywords:["thomas","boy","paj","short"] },
  { image:"images/image19_small.jpg", keywords:["noah","boy","short","stripe","gray","aqua"] },
  { image:"images/image19_small.jpg", keywords:["turquoise","stripe"] },
  { image:"images/image19_small.jpg", keywords:["green","top","navy","short"] },
  { image:"images/image19_small.jpg", keywords:["gray","top","gray","pants"] },
  { image:"images/image19_small.jpg", keywords:["gray","top","green","pants"] },
  { image:"images/image19_small.jpg", keywords:["thomas","stripe","white","blue"] },
  // 20‚Äì25
  { image:"images/image20_small.jpg", keywords:["maisie","baby","top","pants","pink"] },
  { image:"images/image21_small.jpg", keywords:["olivia","girls","long","paj","kindie","pink"] },
  { image:"images/image21_small.jpg", keywords:["olivia","girls","long","paj","kindie","blue"] },
  { image:"images/image22_small.jpg", keywords:["aria","ladies","long","paj","kindie","pink"] },
  { image:"images/image22_small.jpg", keywords:["aria","ladies","long","paj","kindie","light","blue"] },
  { image:"images/image23_small.jpg", keywords:["layla","ladies","short","paj","sleeveless","top","floral"] },
  { image:"images/image24_small.jpg", keywords:["layla","ladies","short","nightie","sleeveless","floral","yellow"] },
  { image:"images/image25_small.jpg", keywords:["sophia","women","shirt","off","white"] },
  { image:"images/image25_small.jpg", keywords:["sophia","women","shirt","blue"] },
  // 26‚Äì33
  { image:"images/image26_small.jpg", keywords:["summer","dressing","gown","lilac"] },
  { image:"images/image26_small.jpg", keywords:["summer","dressing","gown","lemon"] },
  { image:"images/image26_small.jpg", keywords:["summer","blue"] },
  { image:"images/image26_small.jpg", keywords:["summer","lilac"] },
  { image:"images/image26_small.jpg", keywords:["summer","lemon"] },
  { image:"images/image27_small.jpg", keywords:["maya","gown","leopard"] },
  { image:"images/image28_small.jpg", keywords:["josh","gown","check"] },
  { image:"images/image29_small.jpg", keywords:["jack","gown","brown"] },
  { image:"images/image30_small.jpg", keywords:["fireman","raincoat","yellow","no","hat"] },
  { image:"images/image31_small.jpg", keywords:["candy","raincoat","hat","pink"] },
  { image:"images/image32_small.jpg", keywords:["candy","raincoat","pink","no","hat"] },
  { image:"images/image33_small.jpg", keywords:["fireman","raincoat","yellow","hat"] }
];

function resolveImage(name, desc, colour){
  const text = [lc(name), lc(desc), lc(colour)].join(' ');
  for(const r of IMAGE_RULES){
    const all = (r.keywords||[]).every(k => text.includes(k));
    if(all) return r.image;
  }
  // loose fallback
  if(text.includes('ella') && text.includes('princess')) return 'images/image1_small.jpg';
  return 'images/placeholder.webp';
}

/* ================= UI helpers ================= */
function sizesToChips(sizes){
  // sizes is an object: { "2": 3, "4": 1, ... or "S": 5, "M": 2 }
  const entries = Object.entries(sizes)
    .filter(([,q])=> toNum(q)>0)
    .sort((a,b)=>{
      const na = a[0], nb = b[0];
      const ia = parseFloat(na), ib = parseFloat(nb);
      // numeric sizes first in ascending order, then alpha
      if(!isNaN(ia) && !isNaN(ib)) return ia-ib;
      if(!isNaN(ia)) return -1;
      if(!isNaN(ib)) return 1;
      return na.localeCompare(nb);
    });
  return entries.map(([sz,q])=> `<span>${sz} (${q})</span>`).join('');
}

function cardHTML(item, unitWholesale){
  const img = resolveImage(item.name, item.desc, item.colour);
  return `
    <div class="card">
      <div class="imgbox"><img src="${img}" alt="${item.name}" loading="lazy"
        onerror="this.replaceWith(Object.assign(document.createElement('div'),{className:'placeholder',innerHTML:'Photo<br>Coming Soon'}))"></div>
      <div class="body">
        <div class="title">${item.name}</div>
        <div class="muted">${[item.desc, item.colour].filter(Boolean).join(' ‚Ä¢ ')}</div>
        <div class="sizes"><strong>Sizes:</strong> ${sizesToChips(item.sizes) || '‚Äî'}</div>
        <div class="muted">Qty: ${item.qty || '‚Äî'}</div>
        <div class="price-line">
          <span class="tag">RRP: ${aud(item.rrpUnit)}</span>
          <span class="tag">Wholesale: ${aud(unitWholesale)}</span>
        </div>
      </div>
    </div>`;
}

function matchesQ(item,q){
  if(!q) return true;
  const hay = [item.name,item.desc,item.colour,item.category,item.subcat].join(' ').toLowerCase();
  return hay.includes(q.toLowerCase());
}
function rowHasSize(item, target){
  if(!target) return true;
  return toNum(item.sizes[target]) > 0;
}

/* ================= MAIN ================= */
(async function(){
  const diag = document.getElementById('diag');
  const grid = document.getElementById('grid');

  try{
    const {rows, header, map, delim, path} = await loadCSV();

    // Filter out empty names; ensure numeric Qty & RRP at row level for totals
    const validRows = rows.filter(r => norm(r.Item_Name));
    const totalPiecesFromRows = validRows.reduce((s,r)=> s + toNum(r.Qty), 0);
    const totalRRPFromRows    = validRows.reduce((s,r)=> s + (toNum(r.Anchor_Price) * toNum(r.Qty)), 0);

    // Aggregate per item card
    const items = aggregateItems(validRows); // [{name, colour, subcat, desc, category, sizes:{}, qty, rrpUnit}, ...]

    // Compute wholesale factor to hit the page target
    // Use row-level total RRP so we weight correctly even if sizes carry different RRPs
    const factorW = totalRRPFromRows>0 ? (WHOLESALE_TOTAL_TARGET_AUD / totalRRPFromRows) : 0;

    // Header totals
    const totalSKUs = items.length;
    document.getElementById('hero-pill').textContent =
      `${(totalPiecesFromRows||0).toLocaleString()} pieces ‚Ä¢ ${totalSKUs} SKUs`;
    document.getElementById('sum-pieces').textContent   = `${(totalPiecesFromRows||0).toLocaleString()} pieces`;
    document.getElementById('sum-skus').textContent     = `${totalSKUs} SKUs`;
    document.getElementById('sum-rrp').textContent      = `Total RRP: ${aud(totalRRPFromRows)}`;
    document.getElementById('sum-wholesale').textContent= `Wholesale (target): ${aud(WHOLESALE_TOTAL_TARGET_AUD)}`;
    document.getElementById('sum-quick').textContent    = `Quick Sale (target): ${aud(QUICKSALE_TOTAL_TARGET_AUD)}`;

    // Size tiles (across all rows)
    (function buildSizeTiles(){
      const totals = {};
      for(const r of validRows){
        const s = norm(r.Size);
        const q = toNum(r.Qty);
        if(!s || q<=0) continue;
        totals[s] = (totals[s]||0) + q;
      }
      const ordered = Object.entries(totals).sort((a,b)=>{
        const ia = parseFloat(a[0]), ib = parseFloat(b[0]);
        if(!isNaN(ia) && !isNaN(ib)) return ia-ib;
        if(!isNaN(ia)) return -1;
        if(!isNaN(ib)) return 1;
        return a[0].localeCompare(b[0]);
      });
      document.getElementById('size-tiles').innerHTML = ordered.map(([k,v])=>`
        <div class="size-tile">
          <b>${k}</b><span>${(v||0).toLocaleString()} pieces</span>
        </div>
      `).join('');
    })();

    // Populate filters
    const uniq = arr => [...new Set(arr.filter(Boolean))].sort((a,b)=>a.localeCompare(b));
    document.getElementById('size').innerHTML =
      '<option value="">All Sizes</option>' + uniq(validRows.map(r=>norm(r.Size))).map(s=>`<option>${s}</option>`).join('');
    document.getElementById('category').innerHTML =
      '<option value="">All Categories</option>' + uniq(validRows.map(r=>norm(r.Category))).map(s=>`<option>${s}</option>`).join('');

    // Render with filters
    const sizeSel = document.getElementById('size');
    const catSel  = document.getElementById('category');
    const qInput  = document.getElementById('q');

    function render(){
      const q  = qInput.value.trim();
      const sz = sizeSel.value;
      const cat= catSel.value;

      const filtered = items.filter(it =>
        matchesQ(it, q) &&
        rowHasSize(it, sz) &&
        (!cat || lc(it.category) === lc(cat))
      );

      const html = filtered
        .map(it => cardHTML(it, it.rrpUnit * factorW))
        .join('');

      document.getElementById('visible-count').textContent = filtered.length;
      grid.innerHTML = html || '<div class="muted">No results.</div>';
    }
    qInput.addEventListener('input', render);
    sizeSel.addEventListener('change', render);
    catSel.addEventListener('change', render);
    render();

    // Diagnostics
    const found = v => v>=0 ? '‚úì' : '‚Äî';
    const m = map;
    document.getElementById('diag').innerHTML =
      `Loaded <b>${path}</b> ‚Ä¢ delimiter <b>${delim==='\\t'?'TAB':delim}</b> ‚Ä¢ headers:
       Item_Name ${found(m.item)} | Size ${found(m.size)} | Qty ${found(m.qty)} | RRP(Anchor_Price) ${found(m.rrp)} | Colour ${found(m.colour)} | Category ${found(m.category)}.`;

  }catch(e){
    console.error(e);
    document.getElementById('hero-pill').textContent = 'Could not load CSV';
    document.getElementById('grid').innerHTML = '<div class="muted">Error loading products.</div>';
    document.getElementById('diag').innerHTML = `<span class="warn">${e.message}</span><span> ‚Äî Ensure <b>detailed_inventory.csv</b> exists at repo root (or named like one of the candidates) and is a real CSV (comma/semicolon/TAB).</span>`;
  }
})();
</script>
</body>
</html>
