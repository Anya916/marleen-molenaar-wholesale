<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Marleen Molenaar Collection ‚Äî Wholesale Catalogue</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f7fb; --card:#ffffff; --ink:#1f2240; --muted:#6b6f8a;
    --primary:#6b4de6; --pill:#efeaff; --ok:#12a87a; --chip:#f1f3f8;
    --shadow:0 8px 24px rgba(31,34,64,.08)
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{background:linear-gradient(135deg,#7d5df0 0%,#5b43e0 100%);color:#fff;padding:56px 20px 28px;border-bottom-left-radius:24px;border-bottom-right-radius:24px;box-shadow:var(--shadow)}
  .wrap{max-width:1060px;margin:0 auto;padding:0 16px}
  h1{margin:0 0 10px;font-size:44px;line-height:1.05;font-weight:800}
  .meta{display:inline-block;background:rgba(255,255,255,.16);backdrop-filter:blur(2px);border-radius:999px;padding:10px 18px;font-weight:600}
  .section{margin:22px 0}
  .card{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:18px}
  .grid{display:grid;gap:14px}
  .sizes{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
  .size-pill{background:var(--pill);border-radius:12px;padding:18px 16px}
  .size-pill b{display:block;font-size:20px}
  .proof-grid{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .proof h3{margin:0 0 8px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  select,input[type="search"]{appearance:none;border:1px solid #e4e7f1;background:#fff;border-radius:10px;padding:10px 12px;color:var(--ink)}
  input[type="search"]{flex:1;min-width:240px}
  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin:14px 0 32px}
  .item{background:var(--card);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
  .imgbox{height:280px;display:flex;align-items:center;justify-content:center;background:#faf9ff}
  .imgbox img{max-height:100%;max-width:100%;object-fit:contain}
  .ph{color:#c0c3d6;font-size:14px}
  .content{padding:16px}
  .name{font-weight:700;margin:0 0 6px}
  .desc{color:var(--muted);margin:0 0 10px;font-size:14px;min-height:36px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 12px}
  .chip{background:var(--chip);border-radius:999px;padding:6px 10px;font-size:12px}
  footer{background:#171a2e;color:#e7ebff;margin-top:28px}
  footer .wrap{display:grid;grid-template-columns:2fr 1fr;gap:18px;padding:28px 16px}
  footer h3{color:#cfd5ff;margin:0 0 12px}
  a{color:#3d37ff;text-decoration:none}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Marleen Molenaar Collection</h1>
    <div id="meta" class="meta">Loading totals‚Ä¶</div>
  </div>
</header>

<main class="wrap">
  <!-- Size breakdown -->
  <section class="section card">
    <h2 style="margin:0 0 8px">üßµ Size Breakdown ‚Äî Pieces Available</h2>
    <div id="sizeGrid" class="grid sizes"></div>
  </section>

  <!-- Proof links -->
  <section class="section card">
    <h2 style="margin:0 0 12px">üèÜ Verified Luxury Credentials &amp; Proof Links</h2>
    <div class="grid proof-grid">
      <div class="proof card" style="box-shadow:none">
        <h3>Lane Crawford Luxury Retailer</h3>
        <p><a href="https://www.lanecrawford.com/brand/700351/marleen-molenaar-sleepwear/women" target="_blank" rel="noopener">View Brand Page</a></p>
        <p class="muted">Hong Kong‚Äôs premier luxury department store ‚Äî equivalent to Harrods. Establishes brand positioning.</p>
      </div>
      <div class="proof card" style="box-shadow:none">
        <h3>Retail Pricing Evidence</h3>
        <p><a href="https://www.retykle.com" target="_blank" rel="noopener">Retykle Pricing Proof</a></p>
        <p class="muted">Shows premium retail/resale pricing for individual pieces.</p>
      </div>
      <div class="proof card" style="box-shadow:none">
        <h3>Media Coverage</h3>
        <p><a href="https://www.scmp.com/article/533820/eastern-premise" target="_blank" rel="noopener">South China Morning Post</a></p>
        <p class="muted">2006 profile: ‚Äúrunning a children‚Äôs clothing design company under her own name.‚Äù</p>
      </div>
    </div>
  </section>

  <!-- Filters -->
  <div class="toolbar">
    <select id="sizeFilter">
      <option value="">All Sizes</option>
      <option>2</option><option>4</option><option>6</option><option>8</option>
      <option>10</option><option>12</option><option>14</option>
    </select>
    <select id="catFilter"><option value="">All Categories</option></select>
    <input id="q" type="search" placeholder="Search name, colour, description">
  </div>

  <!-- Items -->
  <div id="cards" class="cards"></div>
</main>

<footer>
  <div class="wrap">
    <div>
      <h3>Contact Information</h3>
      <p><b>Gary Flax</b> ‚Ä¢ +61 414 242 142</p>
      <p>Location: Vaucluse, Sydney NSW</p>
      <p>Viewing: Weekdays 5pm+, Weekends anytime</p>
      <p>Access: Ground floor, driveway access for easy pickup</p>
    </div>
    <div>
      <h3>Collection Summary</h3>
      <p id="footPieces">‚Äî</p>
      <p>Organized in <b>50 boxes</b> for easy pickup</p>
      <p>Storage: Professional organization system</p>
      <p id="pricesFoot" class="muted">Wholesale ‚Ä¢ Quick sale available</p>
    </div>
  </div>
</footer>

<script>
(async function(){
  const csvUrl = 'detailed_inventory.csv';
  const imgMapUrl = 'image_map.csv';
  const placeholder = 'images/placeholder.webp';

  // simple robust CSV
  const parseCSV = (text) => {
    if (!text) return [];
    if (text.charCodeAt(0) === 0xFEFF) text = text.slice(1); // BOM
    const rows = [];
    let i=0, field='', row=[], q=false;
    while(i < text.length){
      const c = text[i];
      if (q){
        if (c === '"'){ if (text[i+1] === '"'){ field+='"'; i++; } else { q=false; } }
        else field += c;
      }else{
        if (c === '"'){ q=true; }
        else if (c === ','){ row.push(field.trim()); field=''; }
        else if (c === '\n' || c === '\r'){
          if (field.length || row.length) { row.push(field.trim()); rows.push(row); row=[]; field=''; }
          if (c === '\r' && text[i+1] === '\n') i++;
        }else field += c;
      }
      i++;
    }
    if (field.length || row.length){ row.push(field.trim()); rows.push(row); }
    const headers = rows.shift().map(h => h.trim().toLowerCase());
    return rows.map(r => Object.fromEntries(headers.map((h,idx)=>[h,r[idx]??''])));
  };

  const [invTxt, mapTxt] = await Promise.all([
    fetch(csvUrl).then(r=>r.ok?r.text():Promise.resolve('')),
    fetch(imgMapUrl).then(r=>r.ok?r.text():Promise.resolve(''))
  ]);

  const invRows = parseCSV(invTxt);
  const mapRows = parseCSV(mapTxt);

  // helper: pick value by possible header names
  const pick = (o, names) => {
    const keys = Object.keys(o);
    for (const want of names){
      const k = keys.find(x => x.toLowerCase() === want.toLowerCase());
      if (k && o[k] !== undefined) return o[k];
    }
    return '';
  };

  // build image map (supports image,name OR image,item)
  const imageMap = new Map();
  for (const r of mapRows){
    const img = pick(r,['image']);
    const nm = pick(r,['name','item']);
    if (!img || !nm) continue;
    imageMap.set(nm.toLowerCase(), img);
  }

  // normalise and roll up inventory
  const byKey = new Map(); // key: name|colour
  let totalPieces = 0;
  const sizeTotals = {2:0,4:0,6:0,8:0,10:0,12:0,14:0};
  const seenCats = new Set();

  for (const r of invRows){
    const name = (pick(r,['Item_Name','name']) || '').trim();
    if (!name) continue;

    const desc   = pick(r,['Description']) || '';
    const cat    = pick(r,['Category']) || '';
    const colour = (pick(r,['Colour','Color']) || '').trim();
    const size   = (pick(r,['Size']) || '').toString().trim(); // can be "2","4",...
    const qtyVal = pick(r,['Qty','QTY','qty','Quantity','quantity']) || '0';
    const qty    = parseFloat(String(qtyVal).replace(/[^0-9.-]/g,'')) || 0;

    const rrpVal = pick(r,['RRP','Anchor_Price']) || '';
    const whVal  = pick(r,['Wholesale','Discounted_Price']) || '';
    const rrp    = parseFloat(String(rrpVal).replace(/[^0-9.-]/g,'')) || 0;
    const wh     = parseFloat(String(whVal).replace(/[^0-9.-]/g,'')) || 0;

    seenCats.add(cat);

    const key = (name + '|' + colour).toLowerCase();
    if (!byKey.has(key)){
      byKey.set(key, {name, desc, cat, colour, qty:0, sizes:new Map(), rrp:0, wholesale:0});
    }
    const item = byKey.get(key);
    item.qty += qty;
    totalPieces += qty;
    if (size) { item.sizes.set(size, (item.sizes.get(size)||0) + qty); }
    item.rrp = Math.max(item.rrp, rrp);
    item.wholesale = Math.max(item.wholesale, wh);

    if (sizeTotals[size] !== undefined) sizeTotals[size] += qty;
  }

  // header meta
  document.getElementById('meta').textContent =
    `${totalPieces.toLocaleString()} pieces ‚Ä¢ ${byKey.size} SKUs ‚Ä¢ 50 boxes`;

  // size tiles
  const sg = document.getElementById('sizeGrid'); sg.innerHTML='';
  Object.keys(sizeTotals).forEach(s=>{
    const div = document.createElement('div');
    div.className='size-pill';
    div.innerHTML = `<b>Size ${s}</b><span class="muted">${sizeTotals[s]} pieces</span>`;
    sg.appendChild(div);
  });

  // category filter options
  const catFilter = document.getElementById('catFilter');
  [...seenCats].filter(Boolean).sort().forEach(c=>{
    const opt = document.createElement('option'); opt.textContent=c; catFilter.appendChild(opt);
  });

  // image resolver: try (name+colour) ‚Üí name ‚Üí fuzzy contains
  const resolveImage = (name, colour) => {
    const key1 = (name + ' (' + colour + ')').toLowerCase();
    const key2 = (name + ' - ' + colour).toLowerCase();
    const key3 = (name + '|' + colour).toLowerCase();

    if (imageMap.has((name+' '+colour).toLowerCase())) return imageMap.get((name+' '+colour).toLowerCase());
    if (imageMap.has(key1)) return imageMap.get(key1);
    if (imageMap.has(key2)) return imageMap.get(key2);
    if (imageMap.has(key3)) return imageMap.get(key3);

    if (imageMap.has(name.toLowerCase())) return imageMap.get(name.toLowerCase());

    // fuzzy: any map name containing inventory name
    const hit = [...imageMap.keys()].find(k => k.includes(name.toLowerCase()));
    return hit ? imageMap.get(hit) : '';
  };

  // items array (photos-first)
  const items = [...byKey.values()].sort((a,b)=>{
    const aHas = !!resolveImage(a.name,a.colour);
    const bHas = !!resolveImage(b.name,b.colour);
    if (aHas !== bHas) return aHas? -1 : 1;
    return a.name.localeCompare(b.name);
  });

  // render
  const cards = document.getElementById('cards');
  const fmtAUD = n => n ? `$${n.toFixed(2)} AUD` : '‚Äî';
  const passFilters = it => {
    const sz  = document.getElementById('sizeFilter').value;
    const cat = document.getElementById('catFilter').value;
    const q   = document.getElementById('q').value.toLowerCase();
    if (sz && !it.sizes.has(sz)) return false;
    if (cat && it.cat !== cat) return false;
    if (q){
      const hay = `${it.name} ${it.desc} ${it.colour}`.toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  };

  function render(){
    cards.innerHTML='';
    items.forEach(it=>{
      if (!passFilters(it)) return;

      const imgPath = resolveImage(it.name, it.colour) || placeholder;
      const sizesHtml = [...it.sizes.entries()]
        .sort((a,b)=>Number(a[0])-Number(b[0]))
        .map(([s,c])=>`<span class="chip">${s} √ó ${c}</span>`).join('') || '<span class="chip">Sizes: ‚Äî</span>';

      const el = document.createElement('div');
      el.className='item';
      el.innerHTML = `
        <div class="imgbox">
          ${imgPath ? `<img loading="lazy" src="${imgPath}" alt="${it.name}">` : `<div class="ph">Photo Coming Soon</div>`}
        </div>
        <div class="content">
          <h3 class="name">${it.name}</h3>
          <p class="desc">${[it.desc, it.colour?`Colour: ${it.colour}`:''].filter(Boolean).join(' ‚Ä¢ ')}</p>
          <div class="chips">${sizesHtml}</div>
          <div class="chips">
            <span class="chip"><b>Qty:</b>&nbsp;${it.qty}</span>
            <span class="chip"><b>RRP:</b>&nbsp;${fmtAUD(it.rrp)}</span>
            <span class="chip"><b>Wholesale:</b>&nbsp;${fmtAUD(it.wholesale)}</span>
          </div>
        </div>`;
      cards.appendChild(el);
    });

    // footer summary
    document.getElementById('footPieces').innerHTML =
      `<b>${totalPieces.toLocaleString()}</b> pieces across <b>${items.length}</b> SKUs`;
  }

  ['sizeFilter','catFilter','q'].forEach(id=>document.getElementById(id).addEventListener('input',render));
  render();
})();
</script>
</body>
</html>
